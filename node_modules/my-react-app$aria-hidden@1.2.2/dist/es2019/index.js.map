{"version":3,"sources":["index.js"],"names":["getDefaultParent","originalTarget","document","sampleTarget","Array","isArray","ownerDocument","body","counterMap","WeakMap","uncontrolledNodes","markerMap","lockCount","unwrapHost","node","host","parentNode","correctTargets","parent","targets","map","target","contains","correctedTarget","console","error","filter","x","Boolean","applyAttributeToOthers","markerName","controlAttribute","markerCounter","hiddenNodes","elementsToKeep","Set","elementsToStop","keep","el","has","add","forEach","deep","prototype","call","children","attr","getAttribute","alreadyHidden","counterValue","get","markerValue","set","push","setAttribute","clear","removeAttribute","delete","hideOthers","from","activeParentNode","querySelectorAll","inertOthers","supportsInert","HTMLElement","hasOwnProperty","suppressOthers"],"mappings":"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","file":"index.js","sourcesContent":["const getDefaultParent = (originalTarget) => {\n    if (typeof document === 'undefined') {\n        return null;\n    }\n    const sampleTarget = Array.isArray(originalTarget) ? originalTarget[0] : originalTarget;\n    return sampleTarget.ownerDocument.body;\n};\nlet counterMap = new WeakMap();\nlet uncontrolledNodes = new WeakMap();\nlet markerMap = {};\nlet lockCount = 0;\nconst unwrapHost = (node) => node && (node.host || unwrapHost(node.parentNode));\nconst correctTargets = (parent, targets) => targets.map(target => {\n    if (parent.contains(target)) {\n        return target;\n    }\n    const correctedTarget = unwrapHost(target);\n    if (correctedTarget && parent.contains(correctedTarget)) {\n        return correctedTarget;\n    }\n    console.error('aria-hidden', target, 'in not contained inside', parent, '. Doing nothing');\n    return null;\n}).filter((x) => Boolean(x));\n/**\n * Marks everything except given node(or nodes) as aria-hidden\n * @param {Element | Element[]} originalTarget - elements to keep on the page\n * @param [parentNode] - top element, defaults to document.body\n * @param {String} [markerName] - a special attribute to mark every node\n * @param {String} [controlAttribute] - html Attribute to control\n * @return {Undo} undo command\n */\nconst applyAttributeToOthers = (originalTarget, parentNode, markerName, controlAttribute) => {\n    const targets = correctTargets(parentNode, Array.isArray(originalTarget) ? originalTarget : [originalTarget]);\n    if (!markerMap[markerName]) {\n        markerMap[markerName] = new WeakMap();\n    }\n    const markerCounter = markerMap[markerName];\n    const hiddenNodes = [];\n    const elementsToKeep = new Set();\n    const elementsToStop = new Set(targets);\n    const keep = (el) => {\n        if (!el || elementsToKeep.has(el)) {\n            return;\n        }\n        elementsToKeep.add(el);\n        keep(el.parentNode);\n    };\n    targets.forEach(keep);\n    const deep = (parent) => {\n        if (!parent || elementsToStop.has(parent)) {\n            return;\n        }\n        Array.prototype.forEach.call(parent.children, (node) => {\n            if (elementsToKeep.has(node)) {\n                deep(node);\n            }\n            else {\n                const attr = node.getAttribute(controlAttribute);\n                const alreadyHidden = attr !== null && attr !== 'false';\n                const counterValue = (counterMap.get(node) || 0) + 1;\n                const markerValue = (markerCounter.get(node) || 0) + 1;\n                counterMap.set(node, counterValue);\n                markerCounter.set(node, markerValue);\n                hiddenNodes.push(node);\n                if (counterValue === 1 && alreadyHidden) {\n                    uncontrolledNodes.set(node, true);\n                }\n                if (markerValue === 1) {\n                    node.setAttribute(markerName, 'true');\n                }\n                if (!alreadyHidden) {\n                    node.setAttribute(controlAttribute, 'true');\n                }\n            }\n        });\n    };\n    deep(parentNode);\n    elementsToKeep.clear();\n    lockCount++;\n    return () => {\n        hiddenNodes.forEach((node) => {\n            const counterValue = counterMap.get(node) - 1;\n            const markerValue = markerCounter.get(node) - 1;\n            counterMap.set(node, counterValue);\n            markerCounter.set(node, markerValue);\n            if (!counterValue) {\n                if (!uncontrolledNodes.has(node)) {\n                    node.removeAttribute(controlAttribute);\n                }\n                uncontrolledNodes.delete(node);\n            }\n            if (!markerValue) {\n                node.removeAttribute(markerName);\n            }\n        });\n        lockCount--;\n        if (!lockCount) {\n            // clear\n            counterMap = new WeakMap();\n            counterMap = new WeakMap();\n            uncontrolledNodes = new WeakMap();\n            markerMap = {};\n        }\n    };\n};\n/**\n * Marks everything except given node(or nodes) as aria-hidden\n * @param {Element | Element[]} originalTarget - elements to keep on the page\n * @param [parentNode] - top element, defaults to document.body\n * @param {String} [markerName] - a special attribute to mark every node\n * @return {Undo} undo command\n */\nexport const hideOthers = (originalTarget, parentNode, markerName = 'data-aria-hidden') => {\n    const targets = Array.from(Array.isArray(originalTarget) ? originalTarget : [originalTarget]);\n    const activeParentNode = parentNode || getDefaultParent(originalTarget);\n    if (!activeParentNode) {\n        return () => null;\n    }\n    // we should not hide ariaLive elements - https://github.com/theKashey/aria-hidden/issues/10\n    targets.push(...Array.from(activeParentNode.querySelectorAll('[aria-live]')));\n    return applyAttributeToOthers(targets, activeParentNode, markerName, 'aria-hidden');\n};\n/**\n * Marks everything except given node(or nodes) as inert\n * @param {Element | Element[]} originalTarget - elements to keep on the page\n * @param [parentNode] - top element, defaults to document.body\n * @param {String} [markerName] - a special attribute to mark every node\n * @return {Undo} undo command\n */\nexport const inertOthers = (originalTarget, parentNode, markerName = 'data-inert-ed') => {\n    const activeParentNode = parentNode || getDefaultParent(originalTarget);\n    if (!activeParentNode) {\n        return () => null;\n    }\n    return applyAttributeToOthers(originalTarget, activeParentNode, markerName, 'inert');\n};\n/**\n * @returns if current browser supports inert\n */\nexport const supportsInert = () => typeof HTMLElement !== 'undefined' && HTMLElement.prototype.hasOwnProperty('inert');\n/**\n * Automatic function to \"suppress\" DOM elements - _hide_ or _inert_ in the best possible way\n * @param {Element | Element[]} originalTarget - elements to keep on the page\n * @param [parentNode] - top element, defaults to document.body\n * @param {String} [markerName] - a special attribute to mark every node\n * @return {Undo} undo command\n */\nexport const suppressOthers = (originalTarget, parentNode, markerName = 'data-suppressed') => (supportsInert() ? inertOthers : hideOthers)(originalTarget, parentNode, markerName);\n"]}