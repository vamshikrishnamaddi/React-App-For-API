{"version":3,"sources":["ChildMapping.js"],"names":["exports","__esModule","getChildMapping","mergeChildMappings","getInitialChildMapping","getNextChildMapping","_react","require","children","mapFn","mapper","child","isValidElement","result","Object","create","Children","map","c","forEach","key","prev","next","getValueForKey","nextKeysPending","pendingKeys","prevKey","length","push","i","childMapping","nextKey","pendingNextKey","getProp","prop","props","onExited","cloneElement","bind","in","appear","enter","exit","nextProps","prevChildMapping","nextChildMapping","keys","hasPrev","hasNext","prevChild","isLeaving"],"mappings":"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","file":"ChildMapping.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\nexports.getChildMapping = getChildMapping;\nexports.mergeChildMappings = mergeChildMappings;\nexports.getInitialChildMapping = getInitialChildMapping;\nexports.getNextChildMapping = getNextChildMapping;\n\nvar _react = require(\"react\");\n\n/**\n * Given `this.props.children`, return an object mapping key to child.\n *\n * @param {*} children `this.props.children`\n * @return {object} Mapping of key to child\n */\nfunction getChildMapping(children, mapFn) {\n  var mapper = function mapper(child) {\n    return mapFn && (0, _react.isValidElement)(child) ? mapFn(child) : child;\n  };\n\n  var result = Object.create(null);\n  if (children) _react.Children.map(children, function (c) {\n    return c;\n  }).forEach(function (child) {\n    // run the map function here instead so that the key is the computed one\n    result[child.key] = mapper(child);\n  });\n  return result;\n}\n/**\n * When you're adding or removing children some may be added or removed in the\n * same render pass. We want to show *both* since we want to simultaneously\n * animate elements in and out. This function takes a previous set of keys\n * and a new set of keys and merges them with its best guess of the correct\n * ordering. In the future we may expose some of the utilities in\n * ReactMultiChild to make this easy, but for now React itself does not\n * directly have this concept of the union of prevChildren and nextChildren\n * so we implement it here.\n *\n * @param {object} prev prev children as returned from\n * `ReactTransitionChildMapping.getChildMapping()`.\n * @param {object} next next children as returned from\n * `ReactTransitionChildMapping.getChildMapping()`.\n * @return {object} a key set that contains all keys in `prev` and all keys\n * in `next` in a reasonable order.\n */\n\n\nfunction mergeChildMappings(prev, next) {\n  prev = prev || {};\n  next = next || {};\n\n  function getValueForKey(key) {\n    return key in next ? next[key] : prev[key];\n  } // For each key of `next`, the list of keys to insert before that key in\n  // the combined list\n\n\n  var nextKeysPending = Object.create(null);\n  var pendingKeys = [];\n\n  for (var prevKey in prev) {\n    if (prevKey in next) {\n      if (pendingKeys.length) {\n        nextKeysPending[prevKey] = pendingKeys;\n        pendingKeys = [];\n      }\n    } else {\n      pendingKeys.push(prevKey);\n    }\n  }\n\n  var i;\n  var childMapping = {};\n\n  for (var nextKey in next) {\n    if (nextKeysPending[nextKey]) {\n      for (i = 0; i < nextKeysPending[nextKey].length; i++) {\n        var pendingNextKey = nextKeysPending[nextKey][i];\n        childMapping[nextKeysPending[nextKey][i]] = getValueForKey(pendingNextKey);\n      }\n    }\n\n    childMapping[nextKey] = getValueForKey(nextKey);\n  } // Finally, add the keys which didn't appear before any key in `next`\n\n\n  for (i = 0; i < pendingKeys.length; i++) {\n    childMapping[pendingKeys[i]] = getValueForKey(pendingKeys[i]);\n  }\n\n  return childMapping;\n}\n\nfunction getProp(child, prop, props) {\n  return props[prop] != null ? props[prop] : child.props[prop];\n}\n\nfunction getInitialChildMapping(props, onExited) {\n  return getChildMapping(props.children, function (child) {\n    return (0, _react.cloneElement)(child, {\n      onExited: onExited.bind(null, child),\n      in: true,\n      appear: getProp(child, 'appear', props),\n      enter: getProp(child, 'enter', props),\n      exit: getProp(child, 'exit', props)\n    });\n  });\n}\n\nfunction getNextChildMapping(nextProps, prevChildMapping, onExited) {\n  var nextChildMapping = getChildMapping(nextProps.children);\n  var children = mergeChildMappings(prevChildMapping, nextChildMapping);\n  Object.keys(children).forEach(function (key) {\n    var child = children[key];\n    if (!(0, _react.isValidElement)(child)) return;\n    var hasPrev = (key in prevChildMapping);\n    var hasNext = (key in nextChildMapping);\n    var prevChild = prevChildMapping[key];\n    var isLeaving = (0, _react.isValidElement)(prevChild) && !prevChild.props.in; // item is new (entering)\n\n    if (hasNext && (!hasPrev || isLeaving)) {\n      // console.log('entering', key)\n      children[key] = (0, _react.cloneElement)(child, {\n        onExited: onExited.bind(null, child),\n        in: true,\n        exit: getProp(child, 'exit', nextProps),\n        enter: getProp(child, 'enter', nextProps)\n      });\n    } else if (!hasNext && hasPrev && !isLeaving) {\n      // item is old (exiting)\n      // console.log('leaving', key)\n      children[key] = (0, _react.cloneElement)(child, {\n        in: false\n      });\n    } else if (hasNext && hasPrev && (0, _react.isValidElement)(prevChild)) {\n      // item hasn't changed transition states\n      // copy over the last transition props;\n      // console.log('unchanged', key)\n      children[key] = (0, _react.cloneElement)(child, {\n        onExited: onExited.bind(null, child),\n        in: prevChild.props.in,\n        exit: getProp(child, 'exit', nextProps),\n        enter: getProp(child, 'enter', nextProps)\n      });\n    }\n  });\n  return children;\n}"]}