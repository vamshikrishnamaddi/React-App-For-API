{"version":3,"sources":["useLayout.js"],"names":["Object","defineProperty","exports","value","useLayout","_react","require","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","TypeError","o","minLen","_arrayLikeToArray","n","prototype","toString","call","slice","constructor","name","Array","from","test","iter","Symbol","iterator","isArray","len","length","i","arr2","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","arguments","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","obj","configurable","writable","layoutKeys","useRef","Map","createPartialLayoutItem","useCallback","lazyChild","loc","parentKey","keyMap","current","get","set","children","Set","_keyMap","concat","undefined","unmount","delete","has","_keyMap2","size","patchItem"],"mappings":"AAAA;;;;;;AAEAA,WAAOC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAC3CC,aAAO;AADoC,KAA7C;AAGAD,YAAQE,SAAR,GAAoBA,SAApB;;AAEA,QAAIC,SAASC,QAAQ,oBAAR,CAAb;;AAEA,aAASC,kBAAT,CAA4BC,GAA5B,EAAiC;AAAE,aAAOC,mBAAmBD,GAAnB,KAA2BE,iBAAiBF,GAAjB,CAA3B,IAAoDG,4BAA4BH,GAA5B,CAApD,IAAwFI,oBAA/F;AAAsH;;AAEzJ,aAASA,kBAAT,GAA8B;AAAE,YAAM,IAAIC,SAAJ,CAAc,sIAAd,CAAN;AAA8J;;AAE9L,aAASF,2BAAT,CAAqCG,CAArC,EAAwCC,MAAxC,EAAgD;AAAE,UAAI,CAACD,CAAL,EAAQ,OAAQ,IAAI,OAAOA,CAAP,KAAa,QAAjB,EAA2B,OAAOE,kBAAkBF,CAAlB,EAAqBC,MAArB,CAAP,CAAqC,IAAIE,IAAIjB,OAAOkB,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BN,CAA/B,EAAkCO,KAAlC,CAAwC,CAAxC,EAA2C,CAAC,CAA5C,CAAR,CAAwD,IAAIJ,MAAM,QAAN,IAAkBH,EAAEQ,WAAxB,EAAqCL,IAAIH,EAAEQ,WAAF,CAAcC,IAAlB,CAAwB,IAAIN,MAAM,KAAN,IAAeA,MAAM,KAAzB,EAAgC,OAAOO,MAAMC,IAAN,CAAWX,CAAX,CAAP,CAAsB,IAAIG,MAAM,WAAN,IAAqB,2CAA2CS,IAA3C,CAAgDT,CAAhD,CAAzB,EAA6E,OAAOD,kBAAkBF,CAAlB,EAAqBC,MAArB,CAAP;AAAsC;;AAEha,aAASL,gBAAT,CAA0BiB,IAA1B,EAAgC;AAAE,UAAI,OAAOC,MAAP,KAAkB,WAAlB,IAAiCD,KAAKC,OAAOC,QAAZ,KAAyB,IAA1D,IAAkEF,KAAK,YAAL,KAAsB,IAA5F,EAAkG,OAAOH,MAAMC,IAAN,CAAWE,IAAX,CAAP;AAA0B;;AAE9J,aAASlB,kBAAT,CAA4BD,GAA5B,EAAiC;AAAE,UAAIgB,MAAMM,OAAN,CAActB,GAAd,CAAJ,EAAwB,OAAOQ,kBAAkBR,GAAlB,CAAP;AAAgC;;AAE3F,aAASQ,iBAAT,CAA2BR,GAA3B,EAAgCuB,GAAhC,EAAqC;AAAE,UAAIA,OAAO,IAAP,IAAeA,MAAMvB,IAAIwB,MAA7B,EAAqCD,MAAMvB,IAAIwB,MAAV,CAAkB,KAAK,IAAIC,IAAI,CAAR,EAAWC,OAAO,IAAIV,KAAJ,CAAUO,GAAV,CAAvB,EAAuCE,IAAIF,GAA3C,EAAgDE,GAAhD,EAAqD;AAAEC,aAAKD,CAAL,IAAUzB,IAAIyB,CAAJ,CAAV;AAAmB,OAAC,OAAOC,IAAP;AAAc;;AAEvL,aAASC,OAAT,CAAiBC,MAAjB,EAAyBC,cAAzB,EAAyC;AAAE,UAAIC,OAAOtC,OAAOsC,IAAP,CAAYF,MAAZ,CAAX,CAAgC,IAAIpC,OAAOuC,qBAAX,EAAkC;AAAE,YAAIC,UAAUxC,OAAOuC,qBAAP,CAA6BH,MAA7B,CAAd,CAAoDC,mBAAmBG,UAAUA,QAAQC,MAAR,CAAe,UAAUC,GAAV,EAAe;AAAE,iBAAO1C,OAAO2C,wBAAP,CAAgCP,MAAhC,EAAwCM,GAAxC,EAA6CE,UAApD;AAAiE,SAAjG,CAA7B,GAAkIN,KAAKO,IAAL,CAAUC,KAAV,CAAgBR,IAAhB,EAAsBE,OAAtB,CAAlI;AAAmK,OAAC,OAAOF,IAAP;AAAc;;AAErV,aAASS,aAAT,CAAuBC,MAAvB,EAA+B;AAAE,WAAK,IAAIf,IAAI,CAAb,EAAgBA,IAAIgB,UAAUjB,MAA9B,EAAsCC,GAAtC,EAA2C;AAAE,YAAIiB,SAAS,QAAQD,UAAUhB,CAAV,CAAR,GAAuBgB,UAAUhB,CAAV,CAAvB,GAAsC,EAAnD,CAAuDA,IAAI,CAAJ,GAAQE,QAAQnC,OAAOkD,MAAP,CAAR,EAAwB,CAAC,CAAzB,EAA4BC,OAA5B,CAAoC,UAAUC,GAAV,EAAe;AAAEC,0BAAgBL,MAAhB,EAAwBI,GAAxB,EAA6BF,OAAOE,GAAP,CAA7B;AAA4C,SAAjG,CAAR,GAA6GpD,OAAOsD,yBAAP,GAAmCtD,OAAOuD,gBAAP,CAAwBP,MAAxB,EAAgChD,OAAOsD,yBAAP,CAAiCJ,MAAjC,CAAhC,CAAnC,GAA+Gf,QAAQnC,OAAOkD,MAAP,CAAR,EAAwBC,OAAxB,CAAgC,UAAUC,GAAV,EAAe;AAAEpD,iBAAOC,cAAP,CAAsB+C,MAAtB,EAA8BI,GAA9B,EAAmCpD,OAAO2C,wBAAP,CAAgCO,MAAhC,EAAwCE,GAAxC,CAAnC;AAAmF,SAApI,CAA5N;AAAoW,OAAC,OAAOJ,MAAP;AAAgB;;AAE1f,aAASK,eAAT,CAAyBG,GAAzB,EAA8BJ,GAA9B,EAAmCjD,KAAnC,EAA0C;AAAE,UAAIiD,OAAOI,GAAX,EAAgB;AAAExD,eAAOC,cAAP,CAAsBuD,GAAtB,EAA2BJ,GAA3B,EAAgC,EAAEjD,OAAOA,KAAT,EAAgByC,YAAY,IAA5B,EAAkCa,cAAc,IAAhD,EAAsDC,UAAU,IAAhE,EAAhC;AAA0G,OAA5H,MAAkI;AAAEF,YAAIJ,GAAJ,IAAWjD,KAAX;AAAmB,OAAC,OAAOqD,GAAP;AAAa;;AAEjN,aAASpD,SAAT,GAAqB;AACnB,UAAIuD,aAAa,CAAC,GAAGtD,OAAOuD,MAAX,EAAmB,IAAIC,GAAJ,EAAnB,CAAjB;AACA;;;;;;;;;;;;;;;AAeA,UAAIC,0BAA0B,CAAC,GAAGzD,OAAO0D,WAAX,EAAwB,UAAUX,GAAV,EAAeY,SAAf,EAA0BC,GAA1B,EAA+BC,SAA/B,EAA0C;AAC9F,YAAIC,SAASR,WAAWS,OAAX,CAAmBC,GAAnB,CAAuBjB,GAAvB,CAAb;;AAEA,YAAI,CAACe,MAAL,EAAa;AACXR,qBAAWS,OAAX,CAAmBE,GAAnB,CAAuBlB,GAAvB,EAA4B;AAC1BmB,sBAAU,IAAIC,GAAJ,EADgB;AAE1BR,uBAAWA,SAFe;AAG1BC,iBAAKA,GAHqB;AAI1BC,uBAAWA;AAJe,WAA5B;AAMD,SAPD,MAOO,IAAIC,OAAOD,SAAP,KAAqBA,SAAzB,EAAoC;AACzCP,qBAAWS,OAAX,CAAmBE,GAAnB,CAAuBlB,GAAvB,EAA4BL,cAAcA,cAAc,EAAd,EAAkBoB,MAAlB,CAAd,EAAyC,EAAzC,EAA6C;AACvED,uBAAWA;AAD4D,WAA7C,CAA5B;AAGD;;AAED,YAAIA,SAAJ,EAAe;AACb,cAAIO,UAAUd,WAAWS,OAAX,CAAmBC,GAAnB,CAAuBH,SAAvB,CAAd;;AAEA,cAAIO,OAAJ,EAAa;AACXd,uBAAWS,OAAX,CAAmBE,GAAnB,CAAuBJ,SAAvB,EAAkCnB,cAAcA,cAAc,EAAd,EAAkB0B,OAAlB,CAAd,EAA0C,EAA1C,EAA8C;AAC9EF,wBAAU,IAAIC,GAAJ,CAAQ,GAAGE,MAAH,CAAUnE,mBAAmBkE,QAAQF,QAA3B,CAAV,EAAgD,CAACnB,GAAD,CAAhD,CAAR,CADoE;AAE9EY,yBAAW;AAFmE,aAA9C,CAAlC;AAID,WALD,MAKO;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACAL,uBAAWS,OAAX,CAAmBE,GAAnB,CAAuBJ,SAAvB,EAAkC;AAChCK,wBAAU,IAAIC,GAAJ,CAAQ,CAACpB,GAAD,CAAR,CADsB;AAEhCY,yBAAW,KAFqB;AAGhCC,mBAAKA,IAAI5C,KAAJ,CAAU,CAAV,EAAa,CAAC,CAAd,CAH2B;AAIhC6C,yBAAWS;AAJqB,aAAlC;AAMD;AACF;;AAED,eAAO,SAASC,OAAT,GAAmB;AACxBjB,qBAAWS,OAAX,CAAmBS,MAAnB,CAA0BzB,GAA1B;;AAEA,cAAIc,aAAaP,WAAWS,OAAX,CAAmBU,GAAnB,CAAuBZ,SAAvB,CAAjB,EAAoD;AAClD,gBAAIa,WAAWpB,WAAWS,OAAX,CAAmBC,GAAnB,CAAuBH,SAAvB,CAAf;;AAEA,gBAAIK,WAAW,IAAIC,GAAJ,CAAQO,SAASR,QAAjB,CAAf;AACAA,qBAASM,MAAT,CAAgBzB,GAAhB;AACAO,uBAAWS,OAAX,CAAmBE,GAAnB,CAAuBJ,SAAvB,EAAkCnB,cAAcA,cAAc,EAAd,EAAkBgC,QAAlB,CAAd,EAA2C,EAA3C,EAA+C;AAC/ER,wBAAUA,QADqE;AAE/EP,yBAAWO,SAASS,IAAT,KAAkB;AAFkD,aAA/C,CAAlC;AAID;AACF,SAbD;AAcD,OAvD6B,EAuD3B,CAACrB,UAAD,CAvD2B,CAA9B;AAwDA,UAAIsB,YAAY,CAAC,GAAG5E,OAAO0D,WAAX,EAAwB,UAAUX,GAAV,EAAea,GAAf,EAAoB;AAC1D,YAAIE,SAASR,WAAWS,OAAX,CAAmBC,GAAnB,CAAuBjB,GAAvB,CAAb;;AAEA,YAAIe,MAAJ,EAAY;AACVR,qBAAWS,OAAX,CAAmBE,GAAnB,CAAuBlB,GAAvB,EAA4BL,cAAcA,cAAc,EAAd,EAAkBoB,MAAlB,CAAd,EAAyC,EAAzC,EAA6C;AACvEF,iBAAKA;AADkE,WAA7C,CAA5B;AAGD;AACF,OARe,EAQb,CAACN,UAAD,CARa,CAAhB;AASA,aAAO;AACLG,iCAAyBA,uBADpB;AAELH,oBAAYA,UAFP;AAGLsB,mBAAWA;AAHN,OAAP;AAKD","file":"useLayout.js","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.useLayout = useLayout;\n\nvar _react = require(\"react\");\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction useLayout() {\n  var layoutKeys = (0, _react.useRef)(new Map());\n  /**\n   * The method creates the mirror of the tree in a hashmap structure with a\n   * linked list using `parentKey` and `children`. Adding data to the structure\n   * is reactive to item component rendering and disassembly. Only the rendered\n   * items are in the structure, if a component is moved, removed, or added the\n   * structure is updated automatically.\n   *\n   * useEffect(() => createPartialLayoutItem(...), []);\n   *\n   * The design of this method is to be coupled to `useEffect` which has the\n   * mount and unmount behavior, also handles lifecycle and call order,\n   * `useEffect` in nested components are called bottom-up instead of top-down\n   * as in rendering.\n   */\n\n  var createPartialLayoutItem = (0, _react.useCallback)(function (key, lazyChild, loc, parentKey) {\n    var keyMap = layoutKeys.current.get(key);\n\n    if (!keyMap) {\n      layoutKeys.current.set(key, {\n        children: new Set(),\n        lazyChild: lazyChild,\n        loc: loc,\n        parentKey: parentKey\n      });\n    } else if (keyMap.parentKey !== parentKey) {\n      layoutKeys.current.set(key, _objectSpread(_objectSpread({}, keyMap), {}, {\n        parentKey: parentKey\n      }));\n    }\n\n    if (parentKey) {\n      var _keyMap = layoutKeys.current.get(parentKey);\n\n      if (_keyMap) {\n        layoutKeys.current.set(parentKey, _objectSpread(_objectSpread({}, _keyMap), {}, {\n          children: new Set([].concat(_toConsumableArray(_keyMap.children), [key])),\n          lazyChild: false\n        }));\n      } else {\n        // Pre-initializes the parent layout, as this is linked to\n        // React rendering, the mount is used inside `useEffect`\n        // this causes callbacks from the last rendering to be\n        // called first than parents, starting from the bottom up.\n        //\n        // We just add an initial value then update the parentKey\n        // when the corresponding one is called.\n        layoutKeys.current.set(parentKey, {\n          children: new Set([key]),\n          lazyChild: false,\n          loc: loc.slice(0, -1),\n          parentKey: undefined\n        });\n      }\n    }\n\n    return function unmount() {\n      layoutKeys.current.delete(key);\n\n      if (parentKey && layoutKeys.current.has(parentKey)) {\n        var _keyMap2 = layoutKeys.current.get(parentKey);\n\n        var children = new Set(_keyMap2.children);\n        children.delete(key);\n        layoutKeys.current.set(parentKey, _objectSpread(_objectSpread({}, _keyMap2), {}, {\n          children: children,\n          lazyChild: children.size === 0\n        }));\n      }\n    };\n  }, [layoutKeys]);\n  var patchItem = (0, _react.useCallback)(function (key, loc) {\n    var keyMap = layoutKeys.current.get(key);\n\n    if (keyMap) {\n      layoutKeys.current.set(key, _objectSpread(_objectSpread({}, keyMap), {}, {\n        loc: loc\n      }));\n    }\n  }, [layoutKeys]);\n  return {\n    createPartialLayoutItem: createPartialLayoutItem,\n    layoutKeys: layoutKeys,\n    patchItem: patchItem\n  };\n}"]}