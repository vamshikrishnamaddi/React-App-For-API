{"version":3,"sources":["DragDropManagerImpl.js"],"names":["createStore","reduce","createDragDropActions","DragDropMonitorImpl","HandlerRegistryImpl","makeStoreInstance","debugMode","reduxDevTools","window","__REDUX_DEVTOOLS_EXTENSION__","name","instanceId","DragDropManagerImpl","constructor","isSetUp","handleRefCountChange","shouldSetUp","store","getState","refCount","backend","setup","teardown","monitor","subscribe","receiveBackend","getMonitor","getBackend","getRegistry","registry","getActions","manager","dispatch","bindActionCreator","actionCreator","args","action","apply","actions","Object","keys","boundActions","key"],"mappings":";;;;AAAA,iBAASA,WAAT,QAA4B,OAA5B;AACA,iBAASC,MAAT,QAAuB,YAAvB;AACA,iBAASC,qBAAT,QAAsC,oBAAtC;AACA,iBAASC,mBAAT,QAAoC,uBAApC;AACA,iBAASC,mBAAT,QAAoC,uBAApC;AACA,iBAASC,iBAAT,CAA2BC,SAA3B,EAAsC;AAClC;AACA;AACA,kBAAMC,gBAAgB,OAAOC,MAAP,KAAkB,WAAlB,IAClBA,OAAOC,4BADX;AAEA,mBAAOT,YAAYC,MAAZ,EAAoBK,aACvBC,aADuB,IAEvBA,cAAc;AACVG,sBAAM,UADI;AAEVC,4BAAY;AAFF,aAAd,CAFG,CAAP;AAMH;AACD,eAAO,MAAMC,mBAAN,CAA0B;AAC7BC,wBAAYP,YAAY,KAAxB,EAA+B;AAC3B,qBAAKQ,OAAL,GAAe,KAAf;AACA,qBAAKC,oBAAL,GAA4B,MAAM;AAC9B,0BAAMC,cAAc,KAAKC,KAAL,CAAWC,QAAX,GAAsBC,QAAtB,GAAiC,CAArD;AACA,wBAAI,KAAKC,OAAT,EAAkB;AACd,4BAAIJ,eAAe,CAAC,KAAKF,OAAzB,EAAkC;AAC9B,iCAAKM,OAAL,CAAaC,KAAb;AACA,iCAAKP,OAAL,GAAe,IAAf;AACH,yBAHD,MAIK,IAAI,CAACE,WAAD,IAAgB,KAAKF,OAAzB,EAAkC;AACnC,iCAAKM,OAAL,CAAaE,QAAb;AACA,iCAAKR,OAAL,GAAe,KAAf;AACH;AACJ;AACJ,iBAZD;AAaA,sBAAMG,QAAQZ,kBAAkBC,SAAlB,CAAd;AACA,qBAAKW,KAAL,GAAaA,KAAb;AACA,qBAAKM,OAAL,GAAe,IAAIpB,mBAAJ,CAAwBc,KAAxB,EAA+B,IAAIb,mBAAJ,CAAwBa,KAAxB,CAA/B,CAAf;AACAA,sBAAMO,SAAN,CAAgB,KAAKT,oBAArB;AACH;AACDU,2BAAeL,OAAf,EAAwB;AACpB,qBAAKA,OAAL,GAAeA,OAAf;AACH;AACDM,yBAAa;AACT,uBAAO,KAAKH,OAAZ;AACH;AACDI,yBAAa;AACT,uBAAO,KAAKP,OAAZ;AACH;AACDQ,0BAAc;AACV,uBAAO,KAAKL,OAAL,CAAaM,QAApB;AACH;AACDC,yBAAa;AACT;AACA,sBAAMC,UAAU,IAAhB;AACA,sBAAM,EAAEC,QAAF,KAAe,KAAKf,KAA1B;AACA,yBAASgB,iBAAT,CAA2BC,aAA3B,EAA0C;AACtC,2BAAO,CAAC,GAAGC,IAAJ,KAAa;AAChB,8BAAMC,SAASF,cAAcG,KAAd,CAAoBN,OAApB,EAA6BI,IAA7B,CAAf;AACA,4BAAI,OAAOC,MAAP,KAAkB,WAAtB,EAAmC;AAC/BJ,qCAASI,MAAT;AACH;AACJ,qBALD;AAMH;AACD,sBAAME,UAAUpC,sBAAsB,IAAtB,CAAhB;AACA,uBAAOqC,OAAOC,IAAP,CAAYF,OAAZ,EAAqBrC,MAArB,CAA4B,CAACwC,YAAD,EAAeC,GAAf,KAAuB;AACtD,0BAAMN,SAASE,QAAQI,GAAR,CAAf;AACAD,iCAAaC,GAAb,IAAoBT,kBAAkBG,MAAlB,CAApB;AACA,2BAAOK,YAAP;AACH,iBAJM,EAIJ,EAJI,CAAP;AAKH;AACDT,qBAASI,MAAT,EAAiB;AACb,qBAAKnB,KAAL,CAAWe,QAAX,CAAoBI,MAApB;AACH;AAtD4B","file":"DragDropManagerImpl.js","sourcesContent":["import { createStore } from 'redux';\nimport { reduce } from './reducers';\nimport { createDragDropActions } from './actions/dragDrop';\nimport { DragDropMonitorImpl } from './DragDropMonitorImpl';\nimport { HandlerRegistryImpl } from './HandlerRegistryImpl';\nfunction makeStoreInstance(debugMode) {\n    // TODO: if we ever make a react-native version of this,\n    // we'll need to consider how to pull off dev-tooling\n    const reduxDevTools = typeof window !== 'undefined' &&\n        window.__REDUX_DEVTOOLS_EXTENSION__;\n    return createStore(reduce, debugMode &&\n        reduxDevTools &&\n        reduxDevTools({\n            name: 'dnd-core',\n            instanceId: 'dnd-core',\n        }));\n}\nexport class DragDropManagerImpl {\n    constructor(debugMode = false) {\n        this.isSetUp = false;\n        this.handleRefCountChange = () => {\n            const shouldSetUp = this.store.getState().refCount > 0;\n            if (this.backend) {\n                if (shouldSetUp && !this.isSetUp) {\n                    this.backend.setup();\n                    this.isSetUp = true;\n                }\n                else if (!shouldSetUp && this.isSetUp) {\n                    this.backend.teardown();\n                    this.isSetUp = false;\n                }\n            }\n        };\n        const store = makeStoreInstance(debugMode);\n        this.store = store;\n        this.monitor = new DragDropMonitorImpl(store, new HandlerRegistryImpl(store));\n        store.subscribe(this.handleRefCountChange);\n    }\n    receiveBackend(backend) {\n        this.backend = backend;\n    }\n    getMonitor() {\n        return this.monitor;\n    }\n    getBackend() {\n        return this.backend;\n    }\n    getRegistry() {\n        return this.monitor.registry;\n    }\n    getActions() {\n        /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n        const manager = this;\n        const { dispatch } = this.store;\n        function bindActionCreator(actionCreator) {\n            return (...args) => {\n                const action = actionCreator.apply(manager, args);\n                if (typeof action !== 'undefined') {\n                    dispatch(action);\n                }\n            };\n        }\n        const actions = createDragDropActions(this);\n        return Object.keys(actions).reduce((boundActions, key) => {\n            const action = actions[key];\n            boundActions[key] = bindActionCreator(action);\n            return boundActions;\n        }, {});\n    }\n    dispatch(action) {\n        this.store.dispatch(action);\n    }\n}\n"]}