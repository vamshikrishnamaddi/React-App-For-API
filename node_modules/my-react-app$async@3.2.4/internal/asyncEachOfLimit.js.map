{"version":3,"sources":["asyncEachOfLimit.js"],"names":["Object","defineProperty","exports","value","default","asyncEachOfLimit","_breakLoop","require","_breakLoop2","_interopRequireDefault","obj","__esModule","generator","limit","iteratee","callback","done","canceled","awaiting","running","idx","replenish","next","then","iterDone","iterateeCallback","catch","handleError","err","result","module"],"mappings":"AAAA;;;;;;AAEAA,eAAOC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AACzCC,mBAAO;AADkC,SAA7C;AAGAD,gBAAQE,OAAR,GAAkBC,gBAAlB;;AAEA,YAAIC,aAAaC,QAAQ,aAAR,CAAjB;;AAEA,YAAIC,cAAcC,uBAAuBH,UAAvB,CAAlB;;AAEA,iBAASG,sBAAT,CAAgCC,GAAhC,EAAqC;AAAE,mBAAOA,OAAOA,IAAIC,UAAX,GAAwBD,GAAxB,GAA8B,EAAEN,SAASM,GAAX,EAArC;AAAwD;;AAE/F;AACA,iBAASL,gBAAT,CAA0BO,SAA1B,EAAqCC,KAArC,EAA4CC,QAA5C,EAAsDC,QAAtD,EAAgE;AAC5D,gBAAIC,OAAO,KAAX;AACA,gBAAIC,WAAW,KAAf;AACA,gBAAIC,WAAW,KAAf;AACA,gBAAIC,UAAU,CAAd;AACA,gBAAIC,MAAM,CAAV;;AAEA,qBAASC,SAAT,GAAqB;AACjB;AACA,oBAAIF,WAAWN,KAAX,IAAoBK,QAApB,IAAgCF,IAApC,EAA0C;AAC1C;AACAE,2BAAW,IAAX;AACAN,0BAAUU,IAAV,GAAiBC,IAAjB,CAAsB,CAAC,EAAEpB,KAAF,EAASa,MAAMQ,QAAf,EAAD,KAA+B;AACjD;AACA,wBAAIP,YAAYD,IAAhB,EAAsB;AACtBE,+BAAW,KAAX;AACA,wBAAIM,QAAJ,EAAc;AACVR,+BAAO,IAAP;AACA,4BAAIG,WAAW,CAAf,EAAkB;AACd;AACAJ,qCAAS,IAAT;AACH;AACD;AACH;AACDI;AACAL,6BAASX,KAAT,EAAgBiB,GAAhB,EAAqBK,gBAArB;AACAL;AACAC;AACH,iBAhBD,EAgBGK,KAhBH,CAgBSC,WAhBT;AAiBH;;AAED,qBAASF,gBAAT,CAA0BG,GAA1B,EAA+BC,MAA/B,EAAuC;AACnC;AACAV,2BAAW,CAAX;AACA,oBAAIF,QAAJ,EAAc;AACd,oBAAIW,GAAJ,EAAS,OAAOD,YAAYC,GAAZ,CAAP;;AAET,oBAAIA,QAAQ,KAAZ,EAAmB;AACfZ,2BAAO,IAAP;AACAC,+BAAW,IAAX;AACA;AACH;;AAED,oBAAIY,WAAWrB,YAAYJ,OAAvB,IAAkCY,QAAQG,WAAW,CAAzD,EAA4D;AACxDH,2BAAO,IAAP;AACA;AACA,2BAAOD,SAAS,IAAT,CAAP;AACH;AACDM;AACH;;AAED,qBAASM,WAAT,CAAqBC,GAArB,EAA0B;AACtB,oBAAIX,QAAJ,EAAc;AACdC,2BAAW,KAAX;AACAF,uBAAO,IAAP;AACAD,yBAASa,GAAT;AACH;;AAEDP;AACH;AACDS,eAAO5B,OAAP,GAAiBA,QAAQ,SAAR,CAAjB","file":"asyncEachOfLimit.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.default = asyncEachOfLimit;\n\nvar _breakLoop = require('./breakLoop.js');\n\nvar _breakLoop2 = _interopRequireDefault(_breakLoop);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// for async generators\nfunction asyncEachOfLimit(generator, limit, iteratee, callback) {\n    let done = false;\n    let canceled = false;\n    let awaiting = false;\n    let running = 0;\n    let idx = 0;\n\n    function replenish() {\n        //console.log('replenish')\n        if (running >= limit || awaiting || done) return;\n        //console.log('replenish awaiting')\n        awaiting = true;\n        generator.next().then(({ value, done: iterDone }) => {\n            //console.log('got value', value)\n            if (canceled || done) return;\n            awaiting = false;\n            if (iterDone) {\n                done = true;\n                if (running <= 0) {\n                    //console.log('done nextCb')\n                    callback(null);\n                }\n                return;\n            }\n            running++;\n            iteratee(value, idx, iterateeCallback);\n            idx++;\n            replenish();\n        }).catch(handleError);\n    }\n\n    function iterateeCallback(err, result) {\n        //console.log('iterateeCallback')\n        running -= 1;\n        if (canceled) return;\n        if (err) return handleError(err);\n\n        if (err === false) {\n            done = true;\n            canceled = true;\n            return;\n        }\n\n        if (result === _breakLoop2.default || done && running <= 0) {\n            done = true;\n            //console.log('done iterCb')\n            return callback(null);\n        }\n        replenish();\n    }\n\n    function handleError(err) {\n        if (canceled) return;\n        awaiting = false;\n        done = true;\n        callback(err);\n    }\n\n    replenish();\n}\nmodule.exports = exports['default'];"]}