{"version":3,"sources":["useInteractionFocus.js"],"names":["Object","defineProperty","exports","value","useInteractionFocus","_react","require","_platform","currentInteraction","hasSetupGlobalListeners","hasEventBeforeFocus","hasBlurredWindowRecently","isValidKey","event","metaKey","isMac","altKey","ctrlKey","key","isVirtualClick","mozInputSource","isTrusted","detail","pointerType","isFocusVisible","getInteraction","useEffect","onKeyboard","onClick","onFocus","target","window","document","onBlur","onPointer","type","addEventListener","PointerEvent","removeEventListener"],"mappings":"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","file":"useInteractionFocus.js","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.useInteractionFocus = useInteractionFocus;\n\nvar _react = require(\"react\");\n\nvar _platform = require(\"./platform\");\n\n/**\n * SPDX-FileCopyrightText: Â© 2019 Liferay, Inc. <https://liferay.com>\n * SPDX-License-Identifier: BSD-3-Clause\n */\nvar currentInteraction = null;\nvar hasSetupGlobalListeners = false;\nvar hasEventBeforeFocus = false;\nvar hasBlurredWindowRecently = false;\n\nfunction isValidKey(event) {\n  // Control and Shift keys trigger when navigating back to the tab with keyboard.\n  return !(event.metaKey || !(0, _platform.isMac)() && event.altKey || event.ctrlKey || event.key === 'Control' || event.key === 'Shift' || event.key === 'Meta');\n}\n\nfunction isVirtualClick(event) {\n  if (event.mozInputSource === 0 && event.isTrusted) {\n    return true;\n  }\n\n  return event.detail === 0 && !event.pointerType;\n}\n\nfunction isFocusVisible() {\n  return currentInteraction !== 'pointer';\n}\n\nfunction getInteraction() {\n  return currentInteraction;\n}\n/**\n * Detects what type of interaction the user is doing with the page, using the\n * keyboard, pointer or using screen reader. This works like a singleton even\n * if it is declared more than once.\n *\n * This is inspired by the implementation:\n * https://github.com/adobe/react-spectrum/blob/d10f20a3f4ca7ffa807fcaceb944274da825a7b9/packages/%40react-aria/interactions/src/useFocusVisible.ts\n */\n\n\nfunction useInteractionFocus() {\n  (0, _react.useEffect)(function () {\n    if (hasSetupGlobalListeners) {\n      return;\n    }\n\n    var onKeyboard = function onKeyboard(event) {\n      hasEventBeforeFocus = true;\n\n      if (isValidKey(event)) {\n        currentInteraction = 'keyboard';\n      }\n    };\n\n    var onClick = function onClick(event) {\n      if (isVirtualClick(event)) {\n        hasEventBeforeFocus = true;\n        currentInteraction = 'virtual';\n      }\n    };\n\n    var onFocus = function onFocus(event) {\n      if (event.target === window || event.target === document) {\n        return;\n      }\n\n      if (!hasEventBeforeFocus && !hasBlurredWindowRecently) {\n        currentInteraction = 'virtual';\n      }\n\n      hasEventBeforeFocus = false;\n      hasBlurredWindowRecently = false;\n    };\n\n    var onBlur = function onBlur() {\n      hasEventBeforeFocus = false;\n      hasBlurredWindowRecently = true;\n    };\n\n    var onPointer = function onPointer(event) {\n      currentInteraction = 'pointer';\n\n      if (event.type === 'mousedown' || event.type === 'pointerdown') {\n        hasEventBeforeFocus = true;\n      }\n    };\n\n    document.addEventListener('keydown', onKeyboard, true);\n    document.addEventListener('keyup', onKeyboard, true);\n    document.addEventListener('click', onClick, true);\n    window.addEventListener('focus', onFocus, true);\n    window.addEventListener('blur', onBlur, false);\n\n    if (typeof PointerEvent !== 'undefined') {\n      document.addEventListener('pointerdown', onPointer, true);\n      document.addEventListener('pointermove', onPointer, true);\n      document.addEventListener('pointerup', onPointer, true);\n    } else {\n      document.addEventListener('mousedown', onPointer, true);\n      document.addEventListener('mousemove', onPointer, true);\n      document.addEventListener('mouseup', onPointer, true);\n    }\n\n    hasSetupGlobalListeners = true;\n    return function () {\n      document.removeEventListener('keydown', onKeyboard, true);\n      document.removeEventListener('keyup', onKeyboard, true);\n      document.removeEventListener('click', onClick, true);\n      window.removeEventListener('focus', onFocus, true);\n      window.removeEventListener('blur', onBlur, false);\n\n      if (typeof PointerEvent !== 'undefined') {\n        document.removeEventListener('pointerdown', onPointer, true);\n        document.removeEventListener('pointermove', onPointer, true);\n        document.removeEventListener('pointerup', onPointer, true);\n      } else {\n        document.removeEventListener('mousedown', onPointer, true);\n        document.removeEventListener('mousemove', onPointer, true);\n        document.removeEventListener('mouseup', onPointer, true);\n      }\n\n      hasSetupGlobalListeners = false;\n    };\n  }, []);\n  return {\n    getInteraction: getInteraction,\n    isFocusVisible: isFocusVisible\n  };\n}"]}