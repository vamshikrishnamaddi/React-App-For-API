{"version":3,"sources":["symlink-paths.js"],"names":["path","require","fs","pathExists","symlinkPaths","srcpath","dstpath","callback","isAbsolute","lstat","err","message","replace","dstdir","dirname","relativeToDst","join","exists","relative","symlinkPathsSync","existsSync","Error","module","exports"],"mappings":"AAAA;;;;;;AAEA,UAAMA,OAAOC,QAAQ,mBAAR,CAAb;AACA,UAAMC,KAAKD,QAAQ,0BAAR,CAAX;AACA,UAAME,aAAaF,QAAQ,gBAAR,EAA0BE,UAA7C;;AAEA;;;;;;;;;;;;;;;;;;;;;;AAsBA,aAASC,YAAT,CAAuBC,OAAvB,EAAgCC,OAAhC,EAAyCC,QAAzC,EAAmD;AACjD,UAAIP,KAAKQ,UAAL,CAAgBH,OAAhB,CAAJ,EAA8B;AAC5B,eAAOH,GAAGO,KAAH,CAASJ,OAAT,EAAmBK,GAAD,IAAS;AAChC,cAAIA,GAAJ,EAAS;AACPA,gBAAIC,OAAJ,GAAcD,IAAIC,OAAJ,CAAYC,OAAZ,CAAoB,OAApB,EAA6B,eAA7B,CAAd;AACA,mBAAOL,SAASG,GAAT,CAAP;AACD;AACD,iBAAOH,SAAS,IAAT,EAAe;AACpB,qBAASF,OADW;AAEpB,qBAASA;AAFW,WAAf,CAAP;AAID,SATM,CAAP;AAUD,OAXD,MAWO;AACL,cAAMQ,SAASb,KAAKc,OAAL,CAAaR,OAAb,CAAf;AACA,cAAMS,gBAAgBf,KAAKgB,IAAL,CAAUH,MAAV,EAAkBR,OAAlB,CAAtB;AACA,eAAOF,WAAWY,aAAX,EAA0B,CAACL,GAAD,EAAMO,MAAN,KAAiB;AAChD,cAAIP,GAAJ,EAAS,OAAOH,SAASG,GAAT,CAAP;AACT,cAAIO,MAAJ,EAAY;AACV,mBAAOV,SAAS,IAAT,EAAe;AACpB,uBAASQ,aADW;AAEpB,uBAASV;AAFW,aAAf,CAAP;AAID,WALD,MAKO;AACL,mBAAOH,GAAGO,KAAH,CAASJ,OAAT,EAAmBK,GAAD,IAAS;AAChC,kBAAIA,GAAJ,EAAS;AACPA,oBAAIC,OAAJ,GAAcD,IAAIC,OAAJ,CAAYC,OAAZ,CAAoB,OAApB,EAA6B,eAA7B,CAAd;AACA,uBAAOL,SAASG,GAAT,CAAP;AACD;AACD,qBAAOH,SAAS,IAAT,EAAe;AACpB,yBAASF,OADW;AAEpB,yBAASL,KAAKkB,QAAL,CAAcL,MAAd,EAAsBR,OAAtB;AAFW,eAAf,CAAP;AAID,aATM,CAAP;AAUD;AACF,SAnBM,CAAP;AAoBD;AACF;;AAED,aAASc,gBAAT,CAA2Bd,OAA3B,EAAoCC,OAApC,EAA6C;AAC3C,UAAIW,MAAJ;AACA,UAAIjB,KAAKQ,UAAL,CAAgBH,OAAhB,CAAJ,EAA8B;AAC5BY,iBAASf,GAAGkB,UAAH,CAAcf,OAAd,CAAT;AACA,YAAI,CAACY,MAAL,EAAa,MAAM,IAAII,KAAJ,CAAU,iCAAV,CAAN;AACb,eAAO;AACL,mBAAShB,OADJ;AAEL,mBAASA;AAFJ,SAAP;AAID,OAPD,MAOO;AACL,cAAMQ,SAASb,KAAKc,OAAL,CAAaR,OAAb,CAAf;AACA,cAAMS,gBAAgBf,KAAKgB,IAAL,CAAUH,MAAV,EAAkBR,OAAlB,CAAtB;AACAY,iBAASf,GAAGkB,UAAH,CAAcL,aAAd,CAAT;AACA,YAAIE,MAAJ,EAAY;AACV,iBAAO;AACL,qBAASF,aADJ;AAEL,qBAASV;AAFJ,WAAP;AAID,SALD,MAKO;AACLY,mBAASf,GAAGkB,UAAH,CAAcf,OAAd,CAAT;AACA,cAAI,CAACY,MAAL,EAAa,MAAM,IAAII,KAAJ,CAAU,iCAAV,CAAN;AACb,iBAAO;AACL,qBAAShB,OADJ;AAEL,qBAASL,KAAKkB,QAAL,CAAcL,MAAd,EAAsBR,OAAtB;AAFJ,WAAP;AAID;AACF;AACF;;AAEDiB,WAAOC,OAAP,GAAiB;AACfnB,kBADe;AAEfe;AAFe,KAAjB","file":"symlink-paths.js","sourcesContent":["'use strict'\n\nconst path = require('path')\nconst fs = require('graceful-fs')\nconst pathExists = require('../path-exists').pathExists\n\n/**\n * Function that returns two types of paths, one relative to symlink, and one\n * relative to the current working directory. Checks if path is absolute or\n * relative. If the path is relative, this function checks if the path is\n * relative to symlink or relative to current working directory. This is an\n * initiative to find a smarter `srcpath` to supply when building symlinks.\n * This allows you to determine which path to use out of one of three possible\n * types of source paths. The first is an absolute path. This is detected by\n * `path.isAbsolute()`. When an absolute path is provided, it is checked to\n * see if it exists. If it does it's used, if not an error is returned\n * (callback)/ thrown (sync). The other two options for `srcpath` are a\n * relative url. By default Node's `fs.symlink` works by creating a symlink\n * using `dstpath` and expects the `srcpath` to be relative to the newly\n * created symlink. If you provide a `srcpath` that does not exist on the file\n * system it results in a broken symlink. To minimize this, the function\n * checks to see if the 'relative to symlink' source file exists, and if it\n * does it will use it. If it does not, it checks if there's a file that\n * exists that is relative to the current working directory, if does its used.\n * This preserves the expectations of the original fs.symlink spec and adds\n * the ability to pass in `relative to current working direcotry` paths.\n */\n\nfunction symlinkPaths (srcpath, dstpath, callback) {\n  if (path.isAbsolute(srcpath)) {\n    return fs.lstat(srcpath, (err) => {\n      if (err) {\n        err.message = err.message.replace('lstat', 'ensureSymlink')\n        return callback(err)\n      }\n      return callback(null, {\n        'toCwd': srcpath,\n        'toDst': srcpath\n      })\n    })\n  } else {\n    const dstdir = path.dirname(dstpath)\n    const relativeToDst = path.join(dstdir, srcpath)\n    return pathExists(relativeToDst, (err, exists) => {\n      if (err) return callback(err)\n      if (exists) {\n        return callback(null, {\n          'toCwd': relativeToDst,\n          'toDst': srcpath\n        })\n      } else {\n        return fs.lstat(srcpath, (err) => {\n          if (err) {\n            err.message = err.message.replace('lstat', 'ensureSymlink')\n            return callback(err)\n          }\n          return callback(null, {\n            'toCwd': srcpath,\n            'toDst': path.relative(dstdir, srcpath)\n          })\n        })\n      }\n    })\n  }\n}\n\nfunction symlinkPathsSync (srcpath, dstpath) {\n  let exists\n  if (path.isAbsolute(srcpath)) {\n    exists = fs.existsSync(srcpath)\n    if (!exists) throw new Error('absolute srcpath does not exist')\n    return {\n      'toCwd': srcpath,\n      'toDst': srcpath\n    }\n  } else {\n    const dstdir = path.dirname(dstpath)\n    const relativeToDst = path.join(dstdir, srcpath)\n    exists = fs.existsSync(relativeToDst)\n    if (exists) {\n      return {\n        'toCwd': relativeToDst,\n        'toDst': srcpath\n      }\n    } else {\n      exists = fs.existsSync(srcpath)\n      if (!exists) throw new Error('relative srcpath does not exist')\n      return {\n        'toCwd': srcpath,\n        'toDst': path.relative(dstdir, srcpath)\n      }\n    }\n  }\n}\n\nmodule.exports = {\n  symlinkPaths,\n  symlinkPathsSync\n}\n"]}