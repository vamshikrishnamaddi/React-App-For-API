{"version":3,"sources":["link.js"],"names":["u","require","fromCallback","path","fs","mkdir","pathExists","createLink","srcpath","dstpath","callback","makeLink","link","err","destinationExists","lstat","message","replace","dir","dirname","dirExists","mkdirs","createLinkSync","existsSync","undefined","lstatSync","linkSync","mkdirsSync","module","exports"],"mappings":"AAAA;;;;;;AAEA,UAAMA,IAAIC,QAAQ,2BAAR,EAAwBC,YAAlC;AACA,UAAMC,OAAOF,QAAQ,mBAAR,CAAb;AACA,UAAMG,KAAKH,QAAQ,0BAAR,CAAX;AACA,UAAMI,QAAQJ,QAAQ,WAAR,CAAd;AACA,UAAMK,aAAaL,QAAQ,gBAAR,EAA0BK,UAA7C;;AAEA,aAASC,UAAT,CAAqBC,OAArB,EAA8BC,OAA9B,EAAuCC,QAAvC,EAAiD;AAC/C,eAASC,QAAT,CAAmBH,OAAnB,EAA4BC,OAA5B,EAAqC;AACnCL,WAAGQ,IAAH,CAAQJ,OAAR,EAAiBC,OAAjB,EAA0BI,OAAO;AAC/B,cAAIA,GAAJ,EAAS,OAAOH,SAASG,GAAT,CAAP;AACTH,mBAAS,IAAT;AACD,SAHD;AAID;;AAEDJ,iBAAWG,OAAX,EAAoB,CAACI,GAAD,EAAMC,iBAAN,KAA4B;AAC9C,YAAID,GAAJ,EAAS,OAAOH,SAASG,GAAT,CAAP;AACT,YAAIC,iBAAJ,EAAuB,OAAOJ,SAAS,IAAT,CAAP;AACvBN,WAAGW,KAAH,CAASP,OAAT,EAAmBK,GAAD,IAAS;AACzB,cAAIA,GAAJ,EAAS;AACPA,gBAAIG,OAAJ,GAAcH,IAAIG,OAAJ,CAAYC,OAAZ,CAAoB,OAApB,EAA6B,YAA7B,CAAd;AACA,mBAAOP,SAASG,GAAT,CAAP;AACD;;AAED,gBAAMK,MAAMf,KAAKgB,OAAL,CAAaV,OAAb,CAAZ;AACAH,qBAAWY,GAAX,EAAgB,CAACL,GAAD,EAAMO,SAAN,KAAoB;AAClC,gBAAIP,GAAJ,EAAS,OAAOH,SAASG,GAAT,CAAP;AACT,gBAAIO,SAAJ,EAAe,OAAOT,SAASH,OAAT,EAAkBC,OAAlB,CAAP;AACfJ,kBAAMgB,MAAN,CAAaH,GAAb,EAAkBL,OAAO;AACvB,kBAAIA,GAAJ,EAAS,OAAOH,SAASG,GAAT,CAAP;AACTF,uBAASH,OAAT,EAAkBC,OAAlB;AACD,aAHD;AAID,WAPD;AAQD,SAfD;AAgBD,OAnBD;AAoBD;;AAED,aAASa,cAAT,CAAyBd,OAAzB,EAAkCC,OAAlC,EAA2C;AACzC,YAAMK,oBAAoBV,GAAGmB,UAAH,CAAcd,OAAd,CAA1B;AACA,UAAIK,iBAAJ,EAAuB,OAAOU,SAAP;;AAEvB,UAAI;AACFpB,WAAGqB,SAAH,CAAajB,OAAb;AACD,OAFD,CAEE,OAAOK,GAAP,EAAY;AACZA,YAAIG,OAAJ,GAAcH,IAAIG,OAAJ,CAAYC,OAAZ,CAAoB,OAApB,EAA6B,YAA7B,CAAd;AACA,cAAMJ,GAAN;AACD;;AAED,YAAMK,MAAMf,KAAKgB,OAAL,CAAaV,OAAb,CAAZ;AACA,YAAMW,YAAYhB,GAAGmB,UAAH,CAAcL,GAAd,CAAlB;AACA,UAAIE,SAAJ,EAAe,OAAOhB,GAAGsB,QAAH,CAAYlB,OAAZ,EAAqBC,OAArB,CAAP;AACfJ,YAAMsB,UAAN,CAAiBT,GAAjB;;AAEA,aAAOd,GAAGsB,QAAH,CAAYlB,OAAZ,EAAqBC,OAArB,CAAP;AACD;;AAEDmB,WAAOC,OAAP,GAAiB;AACftB,kBAAYP,EAAEO,UAAF,CADG;AAEfe;AAFe,KAAjB","file":"link.js","sourcesContent":["'use strict'\n\nconst u = require('universalify').fromCallback\nconst path = require('path')\nconst fs = require('graceful-fs')\nconst mkdir = require('../mkdirs')\nconst pathExists = require('../path-exists').pathExists\n\nfunction createLink (srcpath, dstpath, callback) {\n  function makeLink (srcpath, dstpath) {\n    fs.link(srcpath, dstpath, err => {\n      if (err) return callback(err)\n      callback(null)\n    })\n  }\n\n  pathExists(dstpath, (err, destinationExists) => {\n    if (err) return callback(err)\n    if (destinationExists) return callback(null)\n    fs.lstat(srcpath, (err) => {\n      if (err) {\n        err.message = err.message.replace('lstat', 'ensureLink')\n        return callback(err)\n      }\n\n      const dir = path.dirname(dstpath)\n      pathExists(dir, (err, dirExists) => {\n        if (err) return callback(err)\n        if (dirExists) return makeLink(srcpath, dstpath)\n        mkdir.mkdirs(dir, err => {\n          if (err) return callback(err)\n          makeLink(srcpath, dstpath)\n        })\n      })\n    })\n  })\n}\n\nfunction createLinkSync (srcpath, dstpath) {\n  const destinationExists = fs.existsSync(dstpath)\n  if (destinationExists) return undefined\n\n  try {\n    fs.lstatSync(srcpath)\n  } catch (err) {\n    err.message = err.message.replace('lstat', 'ensureLink')\n    throw err\n  }\n\n  const dir = path.dirname(dstpath)\n  const dirExists = fs.existsSync(dir)\n  if (dirExists) return fs.linkSync(srcpath, dstpath)\n  mkdir.mkdirsSync(dir)\n\n  return fs.linkSync(srcpath, dstpath)\n}\n\nmodule.exports = {\n  createLink: u(createLink),\n  createLinkSync\n}\n"]}