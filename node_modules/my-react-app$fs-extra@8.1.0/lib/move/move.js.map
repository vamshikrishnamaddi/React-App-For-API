{"version":3,"sources":["move.js"],"names":["fs","require","path","copy","remove","mkdirp","pathExists","stat","move","src","dest","opts","cb","overwrite","clobber","checkPaths","err","stats","srcStat","checkParentPaths","dirname","doRename","rename","destExists","Error","code","moveAcrossDevice","errorOnExist","module","exports"],"mappings":"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","file":"move.js","sourcesContent":["'use strict'\n\nconst fs = require('graceful-fs')\nconst path = require('path')\nconst copy = require('../copy').copy\nconst remove = require('../remove').remove\nconst mkdirp = require('../mkdirs').mkdirp\nconst pathExists = require('../path-exists').pathExists\nconst stat = require('../util/stat')\n\nfunction move (src, dest, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts\n    opts = {}\n  }\n\n  const overwrite = opts.overwrite || opts.clobber || false\n\n  stat.checkPaths(src, dest, 'move', (err, stats) => {\n    if (err) return cb(err)\n    const { srcStat } = stats\n    stat.checkParentPaths(src, srcStat, dest, 'move', err => {\n      if (err) return cb(err)\n      mkdirp(path.dirname(dest), err => {\n        if (err) return cb(err)\n        return doRename(src, dest, overwrite, cb)\n      })\n    })\n  })\n}\n\nfunction doRename (src, dest, overwrite, cb) {\n  if (overwrite) {\n    return remove(dest, err => {\n      if (err) return cb(err)\n      return rename(src, dest, overwrite, cb)\n    })\n  }\n  pathExists(dest, (err, destExists) => {\n    if (err) return cb(err)\n    if (destExists) return cb(new Error('dest already exists.'))\n    return rename(src, dest, overwrite, cb)\n  })\n}\n\nfunction rename (src, dest, overwrite, cb) {\n  fs.rename(src, dest, err => {\n    if (!err) return cb()\n    if (err.code !== 'EXDEV') return cb(err)\n    return moveAcrossDevice(src, dest, overwrite, cb)\n  })\n}\n\nfunction moveAcrossDevice (src, dest, overwrite, cb) {\n  const opts = {\n    overwrite,\n    errorOnExist: true\n  }\n  copy(src, dest, opts, err => {\n    if (err) return cb(err)\n    return remove(src, cb)\n  })\n}\n\nmodule.exports = move\n"]}