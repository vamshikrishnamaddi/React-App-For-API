{"version":3,"sources":["utimes.js"],"names":["fs","require","os","path","hasMillisResSync","tmpfile","join","Date","now","toString","Math","random","slice","tmpdir","d","writeFileSync","fd","openSync","futimesSync","closeSync","statSync","mtime","hasMillisRes","callback","writeFile","err","open","futimes","close","stat","stats","timeRemoveMillis","timestamp","floor","getTime","Error","utimesMillis","atime","futimesErr","closeErr","utimesMillisSync","module","exports"],"mappings":"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","file":"utimes.js","sourcesContent":["'use strict'\n\nconst fs = require('graceful-fs')\nconst os = require('os')\nconst path = require('path')\n\n// HFS, ext{2,3}, FAT do not, Node.js v0.10 does not\nfunction hasMillisResSync () {\n  let tmpfile = path.join('millis-test-sync' + Date.now().toString() + Math.random().toString().slice(2))\n  tmpfile = path.join(os.tmpdir(), tmpfile)\n\n  // 550 millis past UNIX epoch\n  const d = new Date(1435410243862)\n  fs.writeFileSync(tmpfile, 'https://github.com/jprichardson/node-fs-extra/pull/141')\n  const fd = fs.openSync(tmpfile, 'r+')\n  fs.futimesSync(fd, d, d)\n  fs.closeSync(fd)\n  return fs.statSync(tmpfile).mtime > 1435410243000\n}\n\nfunction hasMillisRes (callback) {\n  let tmpfile = path.join('millis-test' + Date.now().toString() + Math.random().toString().slice(2))\n  tmpfile = path.join(os.tmpdir(), tmpfile)\n\n  // 550 millis past UNIX epoch\n  const d = new Date(1435410243862)\n  fs.writeFile(tmpfile, 'https://github.com/jprichardson/node-fs-extra/pull/141', err => {\n    if (err) return callback(err)\n    fs.open(tmpfile, 'r+', (err, fd) => {\n      if (err) return callback(err)\n      fs.futimes(fd, d, d, err => {\n        if (err) return callback(err)\n        fs.close(fd, err => {\n          if (err) return callback(err)\n          fs.stat(tmpfile, (err, stats) => {\n            if (err) return callback(err)\n            callback(null, stats.mtime > 1435410243000)\n          })\n        })\n      })\n    })\n  })\n}\n\nfunction timeRemoveMillis (timestamp) {\n  if (typeof timestamp === 'number') {\n    return Math.floor(timestamp / 1000) * 1000\n  } else if (timestamp instanceof Date) {\n    return new Date(Math.floor(timestamp.getTime() / 1000) * 1000)\n  } else {\n    throw new Error('fs-extra: timeRemoveMillis() unknown parameter type')\n  }\n}\n\nfunction utimesMillis (path, atime, mtime, callback) {\n  // if (!HAS_MILLIS_RES) return fs.utimes(path, atime, mtime, callback)\n  fs.open(path, 'r+', (err, fd) => {\n    if (err) return callback(err)\n    fs.futimes(fd, atime, mtime, futimesErr => {\n      fs.close(fd, closeErr => {\n        if (callback) callback(futimesErr || closeErr)\n      })\n    })\n  })\n}\n\nfunction utimesMillisSync (path, atime, mtime) {\n  const fd = fs.openSync(path, 'r+')\n  fs.futimesSync(fd, atime, mtime)\n  return fs.closeSync(fd)\n}\n\nmodule.exports = {\n  hasMillisRes,\n  hasMillisResSync,\n  timeRemoveMillis,\n  utimesMillis,\n  utimesMillisSync\n}\n"]}