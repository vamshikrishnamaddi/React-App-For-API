{"version":3,"sources":["graceful-fs.js"],"names":["fs","require","polyfills","legacy","clone","util","gracefulQueue","previousSymbol","Symbol","for","noop","publishQueue","context","queue","Object","defineProperty","get","debug","debuglog","test","process","env","NODE_DEBUG","m","format","apply","arguments","split","join","console","error","global","close","fs$close","fd","cb","call","err","resetQueue","value","closeSync","fs$closeSync","on","equal","length","module","exports","patch","TEST_GRACEFUL_FS_GLOBAL_PATCH","__patched","gracefulify","createReadStream","path","options","ReadStream","createWriteStream","WriteStream","fs$readFile","readFile","go$readFile","startTime","code","enqueue","Date","now","fs$writeFile","writeFile","data","go$writeFile","fs$appendFile","appendFile","go$appendFile","fs$copyFile","copyFile","src","dest","flags","go$copyFile","fs$readdir","readdir","go$readdir","noReaddirOptionVersions","version","fs$readdirCallback","files","sort","substr","legStreams","fs$ReadStream","prototype","create","open","ReadStream$open","fs$WriteStream","WriteStream$open","set","val","enumerable","configurable","FileReadStream","FileWriteStream","that","mode","autoClose","destroy","emit","read","fs$open","go$open","elem","name","push","retry","retryTimer","i","clearTimeout","undefined","shift","fn","args","lastTime","pop","sinceAttempt","sinceStart","Math","max","desiredDelay","min","concat","setTimeout"],"mappings":"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","file":"graceful-fs.js","sourcesContent":["var fs = require('fs')\nvar polyfills = require('./polyfills.js')\nvar legacy = require('./legacy-streams.js')\nvar clone = require('./clone.js')\n\nvar util = require('util')\n\n/* istanbul ignore next - node 0.x polyfill */\nvar gracefulQueue\nvar previousSymbol\n\n/* istanbul ignore else - node 0.x polyfill */\nif (typeof Symbol === 'function' && typeof Symbol.for === 'function') {\n  gracefulQueue = Symbol.for('graceful-fs.queue')\n  // This is used in testing by future versions\n  previousSymbol = Symbol.for('graceful-fs.previous')\n} else {\n  gracefulQueue = '___graceful-fs.queue'\n  previousSymbol = '___graceful-fs.previous'\n}\n\nfunction noop () {}\n\nfunction publishQueue(context, queue) {\n  Object.defineProperty(context, gracefulQueue, {\n    get: function() {\n      return queue\n    }\n  })\n}\n\nvar debug = noop\nif (util.debuglog)\n  debug = util.debuglog('gfs4')\nelse if (/\\bgfs4\\b/i.test(process.env.NODE_DEBUG || ''))\n  debug = function() {\n    var m = util.format.apply(util, arguments)\n    m = 'GFS4: ' + m.split(/\\n/).join('\\nGFS4: ')\n    console.error(m)\n  }\n\n// Once time initialization\nif (!fs[gracefulQueue]) {\n  // This queue can be shared by multiple loaded instances\n  var queue = global[gracefulQueue] || []\n  publishQueue(fs, queue)\n\n  // Patch fs.close/closeSync to shared queue version, because we need\n  // to retry() whenever a close happens *anywhere* in the program.\n  // This is essential when multiple graceful-fs instances are\n  // in play at the same time.\n  fs.close = (function (fs$close) {\n    function close (fd, cb) {\n      return fs$close.call(fs, fd, function (err) {\n        // This function uses the graceful-fs shared queue\n        if (!err) {\n          resetQueue()\n        }\n\n        if (typeof cb === 'function')\n          cb.apply(this, arguments)\n      })\n    }\n\n    Object.defineProperty(close, previousSymbol, {\n      value: fs$close\n    })\n    return close\n  })(fs.close)\n\n  fs.closeSync = (function (fs$closeSync) {\n    function closeSync (fd) {\n      // This function uses the graceful-fs shared queue\n      fs$closeSync.apply(fs, arguments)\n      resetQueue()\n    }\n\n    Object.defineProperty(closeSync, previousSymbol, {\n      value: fs$closeSync\n    })\n    return closeSync\n  })(fs.closeSync)\n\n  if (/\\bgfs4\\b/i.test(process.env.NODE_DEBUG || '')) {\n    process.on('exit', function() {\n      debug(fs[gracefulQueue])\n      require('assert').equal(fs[gracefulQueue].length, 0)\n    })\n  }\n}\n\nif (!global[gracefulQueue]) {\n  publishQueue(global, fs[gracefulQueue]);\n}\n\nmodule.exports = patch(clone(fs))\nif (process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH && !fs.__patched) {\n    module.exports = patch(fs)\n    fs.__patched = true;\n}\n\nfunction patch (fs) {\n  // Everything that references the open() function needs to be in here\n  polyfills(fs)\n  fs.gracefulify = patch\n\n  fs.createReadStream = createReadStream\n  fs.createWriteStream = createWriteStream\n  var fs$readFile = fs.readFile\n  fs.readFile = readFile\n  function readFile (path, options, cb) {\n    if (typeof options === 'function')\n      cb = options, options = null\n\n    return go$readFile(path, options, cb)\n\n    function go$readFile (path, options, cb, startTime) {\n      return fs$readFile(path, options, function (err) {\n        if (err && (err.code === 'EMFILE' || err.code === 'ENFILE'))\n          enqueue([go$readFile, [path, options, cb], err, startTime || Date.now(), Date.now()])\n        else {\n          if (typeof cb === 'function')\n            cb.apply(this, arguments)\n        }\n      })\n    }\n  }\n\n  var fs$writeFile = fs.writeFile\n  fs.writeFile = writeFile\n  function writeFile (path, data, options, cb) {\n    if (typeof options === 'function')\n      cb = options, options = null\n\n    return go$writeFile(path, data, options, cb)\n\n    function go$writeFile (path, data, options, cb, startTime) {\n      return fs$writeFile(path, data, options, function (err) {\n        if (err && (err.code === 'EMFILE' || err.code === 'ENFILE'))\n          enqueue([go$writeFile, [path, data, options, cb], err, startTime || Date.now(), Date.now()])\n        else {\n          if (typeof cb === 'function')\n            cb.apply(this, arguments)\n        }\n      })\n    }\n  }\n\n  var fs$appendFile = fs.appendFile\n  if (fs$appendFile)\n    fs.appendFile = appendFile\n  function appendFile (path, data, options, cb) {\n    if (typeof options === 'function')\n      cb = options, options = null\n\n    return go$appendFile(path, data, options, cb)\n\n    function go$appendFile (path, data, options, cb, startTime) {\n      return fs$appendFile(path, data, options, function (err) {\n        if (err && (err.code === 'EMFILE' || err.code === 'ENFILE'))\n          enqueue([go$appendFile, [path, data, options, cb], err, startTime || Date.now(), Date.now()])\n        else {\n          if (typeof cb === 'function')\n            cb.apply(this, arguments)\n        }\n      })\n    }\n  }\n\n  var fs$copyFile = fs.copyFile\n  if (fs$copyFile)\n    fs.copyFile = copyFile\n  function copyFile (src, dest, flags, cb) {\n    if (typeof flags === 'function') {\n      cb = flags\n      flags = 0\n    }\n    return go$copyFile(src, dest, flags, cb)\n\n    function go$copyFile (src, dest, flags, cb, startTime) {\n      return fs$copyFile(src, dest, flags, function (err) {\n        if (err && (err.code === 'EMFILE' || err.code === 'ENFILE'))\n          enqueue([go$copyFile, [src, dest, flags, cb], err, startTime || Date.now(), Date.now()])\n        else {\n          if (typeof cb === 'function')\n            cb.apply(this, arguments)\n        }\n      })\n    }\n  }\n\n  var fs$readdir = fs.readdir\n  fs.readdir = readdir\n  var noReaddirOptionVersions = /^v[0-5]\\./\n  function readdir (path, options, cb) {\n    if (typeof options === 'function')\n      cb = options, options = null\n\n    var go$readdir = noReaddirOptionVersions.test(process.version)\n      ? function go$readdir (path, options, cb, startTime) {\n        return fs$readdir(path, fs$readdirCallback(\n          path, options, cb, startTime\n        ))\n      }\n      : function go$readdir (path, options, cb, startTime) {\n        return fs$readdir(path, options, fs$readdirCallback(\n          path, options, cb, startTime\n        ))\n      }\n\n    return go$readdir(path, options, cb)\n\n    function fs$readdirCallback (path, options, cb, startTime) {\n      return function (err, files) {\n        if (err && (err.code === 'EMFILE' || err.code === 'ENFILE'))\n          enqueue([\n            go$readdir,\n            [path, options, cb],\n            err,\n            startTime || Date.now(),\n            Date.now()\n          ])\n        else {\n          if (files && files.sort)\n            files.sort()\n\n          if (typeof cb === 'function')\n            cb.call(this, err, files)\n        }\n      }\n    }\n  }\n\n  if (process.version.substr(0, 4) === 'v0.8') {\n    var legStreams = legacy(fs)\n    ReadStream = legStreams.ReadStream\n    WriteStream = legStreams.WriteStream\n  }\n\n  var fs$ReadStream = fs.ReadStream\n  if (fs$ReadStream) {\n    ReadStream.prototype = Object.create(fs$ReadStream.prototype)\n    ReadStream.prototype.open = ReadStream$open\n  }\n\n  var fs$WriteStream = fs.WriteStream\n  if (fs$WriteStream) {\n    WriteStream.prototype = Object.create(fs$WriteStream.prototype)\n    WriteStream.prototype.open = WriteStream$open\n  }\n\n  Object.defineProperty(fs, 'ReadStream', {\n    get: function () {\n      return ReadStream\n    },\n    set: function (val) {\n      ReadStream = val\n    },\n    enumerable: true,\n    configurable: true\n  })\n  Object.defineProperty(fs, 'WriteStream', {\n    get: function () {\n      return WriteStream\n    },\n    set: function (val) {\n      WriteStream = val\n    },\n    enumerable: true,\n    configurable: true\n  })\n\n  // legacy names\n  var FileReadStream = ReadStream\n  Object.defineProperty(fs, 'FileReadStream', {\n    get: function () {\n      return FileReadStream\n    },\n    set: function (val) {\n      FileReadStream = val\n    },\n    enumerable: true,\n    configurable: true\n  })\n  var FileWriteStream = WriteStream\n  Object.defineProperty(fs, 'FileWriteStream', {\n    get: function () {\n      return FileWriteStream\n    },\n    set: function (val) {\n      FileWriteStream = val\n    },\n    enumerable: true,\n    configurable: true\n  })\n\n  function ReadStream (path, options) {\n    if (this instanceof ReadStream)\n      return fs$ReadStream.apply(this, arguments), this\n    else\n      return ReadStream.apply(Object.create(ReadStream.prototype), arguments)\n  }\n\n  function ReadStream$open () {\n    var that = this\n    open(that.path, that.flags, that.mode, function (err, fd) {\n      if (err) {\n        if (that.autoClose)\n          that.destroy()\n\n        that.emit('error', err)\n      } else {\n        that.fd = fd\n        that.emit('open', fd)\n        that.read()\n      }\n    })\n  }\n\n  function WriteStream (path, options) {\n    if (this instanceof WriteStream)\n      return fs$WriteStream.apply(this, arguments), this\n    else\n      return WriteStream.apply(Object.create(WriteStream.prototype), arguments)\n  }\n\n  function WriteStream$open () {\n    var that = this\n    open(that.path, that.flags, that.mode, function (err, fd) {\n      if (err) {\n        that.destroy()\n        that.emit('error', err)\n      } else {\n        that.fd = fd\n        that.emit('open', fd)\n      }\n    })\n  }\n\n  function createReadStream (path, options) {\n    return new fs.ReadStream(path, options)\n  }\n\n  function createWriteStream (path, options) {\n    return new fs.WriteStream(path, options)\n  }\n\n  var fs$open = fs.open\n  fs.open = open\n  function open (path, flags, mode, cb) {\n    if (typeof mode === 'function')\n      cb = mode, mode = null\n\n    return go$open(path, flags, mode, cb)\n\n    function go$open (path, flags, mode, cb, startTime) {\n      return fs$open(path, flags, mode, function (err, fd) {\n        if (err && (err.code === 'EMFILE' || err.code === 'ENFILE'))\n          enqueue([go$open, [path, flags, mode, cb], err, startTime || Date.now(), Date.now()])\n        else {\n          if (typeof cb === 'function')\n            cb.apply(this, arguments)\n        }\n      })\n    }\n  }\n\n  return fs\n}\n\nfunction enqueue (elem) {\n  debug('ENQUEUE', elem[0].name, elem[1])\n  fs[gracefulQueue].push(elem)\n  retry()\n}\n\n// keep track of the timeout between retry() calls\nvar retryTimer\n\n// reset the startTime and lastTime to now\n// this resets the start of the 60 second overall timeout as well as the\n// delay between attempts so that we'll retry these jobs sooner\nfunction resetQueue () {\n  var now = Date.now()\n  for (var i = 0; i < fs[gracefulQueue].length; ++i) {\n    // entries that are only a length of 2 are from an older version, don't\n    // bother modifying those since they'll be retried anyway.\n    if (fs[gracefulQueue][i].length > 2) {\n      fs[gracefulQueue][i][3] = now // startTime\n      fs[gracefulQueue][i][4] = now // lastTime\n    }\n  }\n  // call retry to make sure we're actively processing the queue\n  retry()\n}\n\nfunction retry () {\n  // clear the timer and remove it to help prevent unintended concurrency\n  clearTimeout(retryTimer)\n  retryTimer = undefined\n\n  if (fs[gracefulQueue].length === 0)\n    return\n\n  var elem = fs[gracefulQueue].shift()\n  var fn = elem[0]\n  var args = elem[1]\n  // these items may be unset if they were added by an older graceful-fs\n  var err = elem[2]\n  var startTime = elem[3]\n  var lastTime = elem[4]\n\n  // if we don't have a startTime we have no way of knowing if we've waited\n  // long enough, so go ahead and retry this item now\n  if (startTime === undefined) {\n    debug('RETRY', fn.name, args)\n    fn.apply(null, args)\n  } else if (Date.now() - startTime >= 60000) {\n    // it's been more than 60 seconds total, bail now\n    debug('TIMEOUT', fn.name, args)\n    var cb = args.pop()\n    if (typeof cb === 'function')\n      cb.call(null, err)\n  } else {\n    // the amount of time between the last attempt and right now\n    var sinceAttempt = Date.now() - lastTime\n    // the amount of time between when we first tried, and when we last tried\n    // rounded up to at least 1\n    var sinceStart = Math.max(lastTime - startTime, 1)\n    // backoff. wait longer than the total time we've been retrying, but only\n    // up to a maximum of 100ms\n    var desiredDelay = Math.min(sinceStart * 1.2, 100)\n    // it's been long enough since the last retry, do it again\n    if (sinceAttempt >= desiredDelay) {\n      debug('RETRY', fn.name, args)\n      fn.apply(null, args.concat([startTime]))\n    } else {\n      // if we can't do this job yet, push it to the end of the queue\n      // and let the next iteration check again\n      fs[gracefulQueue].push(elem)\n    }\n  }\n\n  // schedule our next run if one isn't already scheduled\n  if (retryTimer === undefined) {\n    retryTimer = setTimeout(retry, 0)\n  }\n}\n"]}