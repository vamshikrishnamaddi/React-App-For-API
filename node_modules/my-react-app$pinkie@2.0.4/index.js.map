{"version":3,"sources":["index.js"],"names":["PENDING","SETTLED","FULFILLED","REJECTED","NOOP","isNode","global","process","emit","asyncSetTimer","setImmediate","setTimeout","asyncQueue","asyncTimer","asyncFlush","i","length","asyncCall","callback","arg","push","invokeResolver","resolver","promise","resolvePromise","value","resolve","rejectPromise","reason","reject","e","invokeCallback","subscriber","owner","settled","_state","_data","then","handleThenable","resolved","TypeError","call","val","fulfill","publishFulfillment","publishRejection","publish","_then","forEach","_handled","notifyRejectionHandled","Promise","prototype","constructor","undefined","onFulfillment","onRejection","fulfilled","rejected","catch","all","promises","Array","isArray","results","remaining","index","race","module","exports"],"mappings":"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","file":"index.js","sourcesContent":["'use strict';\n\nvar PENDING = 'pending';\nvar SETTLED = 'settled';\nvar FULFILLED = 'fulfilled';\nvar REJECTED = 'rejected';\nvar NOOP = function () {};\nvar isNode = typeof global !== 'undefined' && typeof global.process !== 'undefined' && typeof global.process.emit === 'function';\n\nvar asyncSetTimer = typeof setImmediate === 'undefined' ? setTimeout : setImmediate;\nvar asyncQueue = [];\nvar asyncTimer;\n\nfunction asyncFlush() {\n\t// run promise callbacks\n\tfor (var i = 0; i < asyncQueue.length; i++) {\n\t\tasyncQueue[i][0](asyncQueue[i][1]);\n\t}\n\n\t// reset async asyncQueue\n\tasyncQueue = [];\n\tasyncTimer = false;\n}\n\nfunction asyncCall(callback, arg) {\n\tasyncQueue.push([callback, arg]);\n\n\tif (!asyncTimer) {\n\t\tasyncTimer = true;\n\t\tasyncSetTimer(asyncFlush, 0);\n\t}\n}\n\nfunction invokeResolver(resolver, promise) {\n\tfunction resolvePromise(value) {\n\t\tresolve(promise, value);\n\t}\n\n\tfunction rejectPromise(reason) {\n\t\treject(promise, reason);\n\t}\n\n\ttry {\n\t\tresolver(resolvePromise, rejectPromise);\n\t} catch (e) {\n\t\trejectPromise(e);\n\t}\n}\n\nfunction invokeCallback(subscriber) {\n\tvar owner = subscriber.owner;\n\tvar settled = owner._state;\n\tvar value = owner._data;\n\tvar callback = subscriber[settled];\n\tvar promise = subscriber.then;\n\n\tif (typeof callback === 'function') {\n\t\tsettled = FULFILLED;\n\t\ttry {\n\t\t\tvalue = callback(value);\n\t\t} catch (e) {\n\t\t\treject(promise, e);\n\t\t}\n\t}\n\n\tif (!handleThenable(promise, value)) {\n\t\tif (settled === FULFILLED) {\n\t\t\tresolve(promise, value);\n\t\t}\n\n\t\tif (settled === REJECTED) {\n\t\t\treject(promise, value);\n\t\t}\n\t}\n}\n\nfunction handleThenable(promise, value) {\n\tvar resolved;\n\n\ttry {\n\t\tif (promise === value) {\n\t\t\tthrow new TypeError('A promises callback cannot return that same promise.');\n\t\t}\n\n\t\tif (value && (typeof value === 'function' || typeof value === 'object')) {\n\t\t\t// then should be retrieved only once\n\t\t\tvar then = value.then;\n\n\t\t\tif (typeof then === 'function') {\n\t\t\t\tthen.call(value, function (val) {\n\t\t\t\t\tif (!resolved) {\n\t\t\t\t\t\tresolved = true;\n\n\t\t\t\t\t\tif (value === val) {\n\t\t\t\t\t\t\tfulfill(promise, val);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresolve(promise, val);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, function (reason) {\n\t\t\t\t\tif (!resolved) {\n\t\t\t\t\t\tresolved = true;\n\n\t\t\t\t\t\treject(promise, reason);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t} catch (e) {\n\t\tif (!resolved) {\n\t\t\treject(promise, e);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\nfunction resolve(promise, value) {\n\tif (promise === value || !handleThenable(promise, value)) {\n\t\tfulfill(promise, value);\n\t}\n}\n\nfunction fulfill(promise, value) {\n\tif (promise._state === PENDING) {\n\t\tpromise._state = SETTLED;\n\t\tpromise._data = value;\n\n\t\tasyncCall(publishFulfillment, promise);\n\t}\n}\n\nfunction reject(promise, reason) {\n\tif (promise._state === PENDING) {\n\t\tpromise._state = SETTLED;\n\t\tpromise._data = reason;\n\n\t\tasyncCall(publishRejection, promise);\n\t}\n}\n\nfunction publish(promise) {\n\tpromise._then = promise._then.forEach(invokeCallback);\n}\n\nfunction publishFulfillment(promise) {\n\tpromise._state = FULFILLED;\n\tpublish(promise);\n}\n\nfunction publishRejection(promise) {\n\tpromise._state = REJECTED;\n\tpublish(promise);\n\tif (!promise._handled && isNode) {\n\t\tglobal.process.emit('unhandledRejection', promise._data, promise);\n\t}\n}\n\nfunction notifyRejectionHandled(promise) {\n\tglobal.process.emit('rejectionHandled', promise);\n}\n\n/**\n * @class\n */\nfunction Promise(resolver) {\n\tif (typeof resolver !== 'function') {\n\t\tthrow new TypeError('Promise resolver ' + resolver + ' is not a function');\n\t}\n\n\tif (this instanceof Promise === false) {\n\t\tthrow new TypeError('Failed to construct \\'Promise\\': Please use the \\'new\\' operator, this object constructor cannot be called as a function.');\n\t}\n\n\tthis._then = [];\n\n\tinvokeResolver(resolver, this);\n}\n\nPromise.prototype = {\n\tconstructor: Promise,\n\n\t_state: PENDING,\n\t_then: null,\n\t_data: undefined,\n\t_handled: false,\n\n\tthen: function (onFulfillment, onRejection) {\n\t\tvar subscriber = {\n\t\t\towner: this,\n\t\t\tthen: new this.constructor(NOOP),\n\t\t\tfulfilled: onFulfillment,\n\t\t\trejected: onRejection\n\t\t};\n\n\t\tif ((onRejection || onFulfillment) && !this._handled) {\n\t\t\tthis._handled = true;\n\t\t\tif (this._state === REJECTED && isNode) {\n\t\t\t\tasyncCall(notifyRejectionHandled, this);\n\t\t\t}\n\t\t}\n\n\t\tif (this._state === FULFILLED || this._state === REJECTED) {\n\t\t\t// already resolved, call callback async\n\t\t\tasyncCall(invokeCallback, subscriber);\n\t\t} else {\n\t\t\t// subscribe\n\t\t\tthis._then.push(subscriber);\n\t\t}\n\n\t\treturn subscriber.then;\n\t},\n\n\tcatch: function (onRejection) {\n\t\treturn this.then(null, onRejection);\n\t}\n};\n\nPromise.all = function (promises) {\n\tif (!Array.isArray(promises)) {\n\t\tthrow new TypeError('You must pass an array to Promise.all().');\n\t}\n\n\treturn new Promise(function (resolve, reject) {\n\t\tvar results = [];\n\t\tvar remaining = 0;\n\n\t\tfunction resolver(index) {\n\t\t\tremaining++;\n\t\t\treturn function (value) {\n\t\t\t\tresults[index] = value;\n\t\t\t\tif (!--remaining) {\n\t\t\t\t\tresolve(results);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tfor (var i = 0, promise; i < promises.length; i++) {\n\t\t\tpromise = promises[i];\n\n\t\t\tif (promise && typeof promise.then === 'function') {\n\t\t\t\tpromise.then(resolver(i), reject);\n\t\t\t} else {\n\t\t\t\tresults[i] = promise;\n\t\t\t}\n\t\t}\n\n\t\tif (!remaining) {\n\t\t\tresolve(results);\n\t\t}\n\t});\n};\n\nPromise.race = function (promises) {\n\tif (!Array.isArray(promises)) {\n\t\tthrow new TypeError('You must pass an array to Promise.race().');\n\t}\n\n\treturn new Promise(function (resolve, reject) {\n\t\tfor (var i = 0, promise; i < promises.length; i++) {\n\t\t\tpromise = promises[i];\n\n\t\t\tif (promise && typeof promise.then === 'function') {\n\t\t\t\tpromise.then(resolve, reject);\n\t\t\t} else {\n\t\t\t\tresolve(promise);\n\t\t\t}\n\t\t}\n\t});\n};\n\nPromise.resolve = function (value) {\n\tif (value && typeof value === 'object' && value.constructor === Promise) {\n\t\treturn value;\n\t}\n\n\treturn new Promise(function (resolve) {\n\t\tresolve(value);\n\t});\n};\n\nPromise.reject = function (reason) {\n\treturn new Promise(function (resolve, reject) {\n\t\treject(reason);\n\t});\n};\n\nmodule.exports = Promise;\n"]}