{"version":3,"sources":["useFocusManagement.js"],"names":["Object","defineProperty","exports","value","FOCUSABLE_ELEMENTS","isFocusable","useFocusManagement","_react","_interopRequireDefault","require","obj","__esModule","default","HostComponent","minimalTabIndex","_ref","_tagName","contentEditable","disabled","href","offsetParent","rel","tabIndex","tagName","type","toLowerCase","hasSibling","collectDocumentFocusableElements","Array","from","document","querySelectorAll","join","filter","element","window","getComputedStyle","visibility","isFiberHostComponentFocusable","fiber","tag","memoizedProps","stateNode","collectFocusableElements","node","focusableElements","push","child","sibling","getFiber","scope","current","internalKey","keys","find","key","indexOf","getFocusableElementsInScope","fiberNode","nextFocusInDocRef","useRef","prevFocusInDocRef","moveFocusInScope","_scope$alternate","backwards","arguments","length","undefined","persistOnScope","fiberFocusElements","alternate","activeElement","docFocusElements","docPosition","reactFiberPosition","startFocusTrap","getAttribute","endFocusTrap","nextFocusInDoc","prevFocusInDoc","nextFocusInFiber","prevFocusInFiber","_","index","array","nextActive","focus","focusFirst","next","focusNext","focusPrevious"],"mappings":"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","file":"useFocusManagement.js","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.FOCUSABLE_ELEMENTS = void 0;\nexports.isFocusable = isFocusable;\nexports.useFocusManagement = useFocusManagement;\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * SPDX-FileCopyrightText: Â© 2019 Liferay, Inc. <https://liferay.com>\n * SPDX-License-Identifier: BSD-3-Clause\n */\n// https://github.com/facebook/react/blob/master/packages/shared/ReactWorkTags.js#L39\nvar HostComponent = 5;\nvar minimalTabIndex = 0;\n\nfunction isFocusable(_ref) {\n  var _tagName;\n\n  var contentEditable = _ref.contentEditable,\n      disabled = _ref.disabled,\n      href = _ref.href,\n      offsetParent = _ref.offsetParent,\n      rel = _ref.rel,\n      tabIndex = _ref.tabIndex,\n      tagName = _ref.tagName,\n      type = _ref.type;\n  // Normalize casing\n  tagName = (_tagName = tagName) === null || _tagName === void 0 ? void 0 : _tagName.toLowerCase(); // Hack to check if element is visible\n\n  if (!offsetParent) {\n    return false;\n  }\n\n  if (disabled) {\n    return false;\n  }\n\n  if (tabIndex != null && tabIndex < minimalTabIndex) {\n    return false;\n  }\n\n  if (tabIndex != null && tabIndex >= minimalTabIndex || contentEditable === true || contentEditable === 'true') {\n    return true;\n  }\n\n  if (tagName === 'a' || tagName === 'area') {\n    return !!href && rel !== 'ignore';\n  }\n\n  if (tagName === 'input') {\n    return type !== 'file' && type !== 'hidden';\n  }\n\n  return tagName === 'button' || tagName === 'embed' || tagName === 'iframe' || tagName === 'object' || tagName === 'select' || tagName === 'textarea';\n}\n\nvar FOCUSABLE_ELEMENTS = ['a[href]', '[contenteditable]', '[tabindex]:not([tabindex^=\"-\"])', 'area[href]', 'button:not([disabled])', 'embed', 'iframe', 'input:not([disabled]):not([type=\"hidden\"])', 'object', 'select:not([disabled]):not([aria-hidden])', 'textarea:not([disabled]):not([aria-hidden])']; // A switcher that helps define which fiber to use to navigate, the\n// component's current fiber or the fiber in progress.\n\nexports.FOCUSABLE_ELEMENTS = FOCUSABLE_ELEMENTS;\nvar hasSibling = false;\n\nfunction collectDocumentFocusableElements() {\n  return Array.from(document.querySelectorAll(FOCUSABLE_ELEMENTS.join(','))).filter(function (element) {\n    if (isFocusable(element)) {\n      return window.getComputedStyle(element).visibility !== 'hidden';\n    }\n\n    return false;\n  });\n} // https://github.com/facebook/react/pull/15849#diff-39a673d38713257d5fe7d90aac2acb5aR107\n\n\nvar isFiberHostComponentFocusable = function isFiberHostComponentFocusable(fiber) {\n  if (fiber.tag !== HostComponent) {\n    return false;\n  }\n\n  var memoizedProps = fiber.memoizedProps,\n      stateNode = fiber.stateNode,\n      type = fiber.type; // The element may be having an update in progress.\n\n  if (memoizedProps === null) {\n    return false;\n  }\n\n  return isFocusable({\n    contentEditable: memoizedProps.contentEditable,\n    disabled: memoizedProps.disabled,\n    href: memoizedProps.href,\n    offsetParent: stateNode.offsetParent,\n    rel: memoizedProps.rel,\n    tabIndex: memoizedProps.tabIndex,\n    tagName: type,\n    type: memoizedProps.type\n  });\n};\n\nvar collectFocusableElements = function collectFocusableElements(node, focusableElements) {\n  if (isFiberHostComponentFocusable(node)) {\n    focusableElements.push(node.stateNode);\n  }\n\n  var child = node.child;\n\n  if (child !== null) {\n    collectFocusableElements(child, focusableElements);\n  }\n\n  var sibling = node.sibling;\n\n  if (sibling) {\n    hasSibling = true;\n    collectFocusableElements(sibling, focusableElements);\n  }\n};\n\nvar getFiber = function getFiber(scope) {\n  if (!scope.current) {\n    return null;\n  }\n\n  var internalKey = Object.keys(scope.current).find(function (key) {\n    return key.indexOf('__reactInternalInstance') === 0 || key.indexOf('__reactFiber') === 0;\n  });\n\n  if (internalKey) {\n    return scope.current[internalKey];\n  }\n\n  return null;\n};\n\nvar getFocusableElementsInScope = function getFocusableElementsInScope(fiberNode) {\n  var focusableElements = [];\n  var child = fiberNode.child;\n\n  if (child !== null) {\n    collectFocusableElements(child, focusableElements);\n  }\n\n  return focusableElements;\n};\n\nfunction useFocusManagement(scope) {\n  var nextFocusInDocRef = _react.default.useRef(null);\n\n  var prevFocusInDocRef = _react.default.useRef(null);\n\n  var moveFocusInScope = function moveFocusInScope(scope) {\n    var _scope$alternate;\n\n    var backwards = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    var persistOnScope = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    var fiberFocusElements = getFocusableElementsInScope((_scope$alternate = scope.alternate) !== null && _scope$alternate !== void 0 ? _scope$alternate : scope); // When browsing the alternate/in progress fiber if don't find sibling\n    // elements that might correspond to a React.Portal try searching for\n    // focusable elements using the current fiber.\n\n    if (!hasSibling) {\n      fiberFocusElements = getFocusableElementsInScope(scope);\n    } else {\n      // Just resets the value for the next focus iteration.\n      hasSibling = false;\n    }\n\n    if (fiberFocusElements.length === 0) {\n      return null;\n    }\n\n    var activeElement = document.activeElement;\n\n    if (!activeElement) {\n      return;\n    }\n\n    var docFocusElements = collectDocumentFocusableElements();\n    var docPosition = docFocusElements.indexOf(activeElement);\n    var reactFiberPosition = fiberFocusElements.indexOf(activeElement);\n    var startFocusTrap = fiberFocusElements.find(function (element) {\n      return element.getAttribute('data-focus-scope-start') === 'true';\n    });\n    var endFocusTrap = fiberFocusElements.find(function (element) {\n      return element.getAttribute('data-focus-scope-end') === 'true';\n    });\n    var nextFocusInDoc = docFocusElements[docPosition + 1];\n    var prevFocusInDoc = docFocusElements[docPosition - 1]; // Ignore when the active element is not in the scope.\n\n    if (reactFiberPosition < 0 && !prevFocusInDocRef.current && !nextFocusInDocRef.current && nextFocusInDoc !== endFocusTrap && prevFocusInDoc !== startFocusTrap) {\n      return null;\n    }\n\n    var nextFocusInFiber = fiberFocusElements[reactFiberPosition + 1];\n    var prevFocusInFiber = fiberFocusElements[reactFiberPosition - 1]; // If the focus is moving within the focus trap, let the browser handle\n    // navigation and focus order.\n\n    if (startFocusTrap && endFocusTrap && startFocusTrap !== prevFocusInDoc && endFocusTrap !== nextFocusInDoc) {\n      return null;\n    } // Checks if the focus has reached the end of the scope and should\n    // go back to the beginning.\n\n\n    if (endFocusTrap && endFocusTrap === nextFocusInDoc) {\n      nextFocusInFiber = docFocusElements.find(function (_, index, array) {\n        return array[index - 1] === startFocusTrap;\n      });\n    } // Checks if the focus has arrived at the beginning of the scope and is\n    // returning moves the focus to the end of the scope.\n\n\n    if (startFocusTrap && startFocusTrap === prevFocusInDoc) {\n      prevFocusInFiber = docFocusElements.find(function (_, index, array) {\n        return array[index + 1] === endFocusTrap;\n      });\n    } // Only moves to the next element if it is in scope.\n\n\n    if (persistOnScope && (!nextFocusInFiber || backwards && !prevFocusInFiber)) {\n      return null;\n    } // If these two nodes are not equal, that means React is likely using\n    // a portal to render the node in a different part of the DOM. When\n    // this happens, we want to track where the next node is in case we\n    // reach the end of the list of focusable nodes.\n\n\n    if (nextFocusInFiber !== nextFocusInDoc) {\n      nextFocusInDocRef.current = nextFocusInDoc;\n    } // Same as above, except we track the previous node for tabbing backwards.\n\n\n    if (prevFocusInFiber !== prevFocusInDoc) {\n      prevFocusInDocRef.current = prevFocusInDoc;\n    }\n\n    var nextActive = backwards ? prevFocusInFiber : nextFocusInFiber; // We track the previous and next elements in the document flow due to React portals.\n    //\n    // Consider the following structure of dom elements and where a React Tree is:\n    //\n    // <HtmlFocusElement1>\n    // <ReactTree>\n    // <HtmlFocusElement2>\n    //\n    // When our focus gets to the end of the React Tree, we want to focus HtmlFocusElement2\n    // When we are at the beginning of the React Tree and want to go backwards with\n    // SHIFT + TAB, we want to focus HtmlFocusElement1. This allows the React Tree to\n    // render nodes whereever it would like in the document.\n    //\n    // If there is no `nextActive`, that means we are either at the beginning or end of the\n    // list of focusable elements in the React Tree. So we go back to the flow of the\n    // document instead of the flow of the React Tree.\n\n    if (!nextActive) {\n      nextActive = backwards ? prevFocusInDocRef.current : nextFocusInDocRef.current;\n    }\n\n    if (nextActive) {\n      nextActive.focus();\n\n      if (nextActive === prevFocusInDocRef.current || nextActive === nextFocusInDocRef.current) {\n        nextFocusInDocRef.current = null;\n        prevFocusInDocRef.current = null;\n      }\n\n      return nextActive;\n    }\n\n    return null;\n  };\n\n  return {\n    focusFirst: function focusFirst() {\n      minimalTabIndex = -1;\n      var next = moveFocusInScope(getFiber(scope), false, true);\n      minimalTabIndex = 0;\n      return next;\n    },\n    focusNext: function focusNext(persistOnScope) {\n      return moveFocusInScope(getFiber(scope), false, persistOnScope);\n    },\n    focusPrevious: function focusPrevious(persistOnScope) {\n      return moveFocusInScope(getFiber(scope), true, persistOnScope);\n    }\n  };\n}"]}