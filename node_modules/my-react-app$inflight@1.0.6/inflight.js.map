{"version":3,"sources":["inflight.js"],"names":["wrappy","require","reqs","Object","create","once","module","exports","inflight","key","cb","push","makeres","RES","cbs","len","length","args","slice","arguments","i","apply","splice","process","nextTick","array"],"mappings":";;;;AAAA,QAAIA,SAASC,QAAQ,qBAAR,CAAb;AACA,QAAIC,OAAOC,OAAOC,MAAP,CAAc,IAAd,CAAX;AACA,QAAIC,OAAOJ,QAAQ,mBAAR,CAAX;;AAEAK,WAAOC,OAAP,GAAiBP,OAAOQ,QAAP,CAAjB;;AAEA,aAASA,QAAT,CAAmBC,GAAnB,EAAwBC,EAAxB,EAA4B;AAC1B,UAAIR,KAAKO,GAAL,CAAJ,EAAe;AACbP,aAAKO,GAAL,EAAUE,IAAV,CAAeD,EAAf;AACA,eAAO,IAAP;AACD,OAHD,MAGO;AACLR,aAAKO,GAAL,IAAY,CAACC,EAAD,CAAZ;AACA,eAAOE,QAAQH,GAAR,CAAP;AACD;AACF;;AAED,aAASG,OAAT,CAAkBH,GAAlB,EAAuB;AACrB,aAAOJ,KAAK,SAASQ,GAAT,GAAgB;AAC1B,YAAIC,MAAMZ,KAAKO,GAAL,CAAV;AACA,YAAIM,MAAMD,IAAIE,MAAd;AACA,YAAIC,OAAOC,MAAMC,SAAN,CAAX;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,YAAI;AACF,eAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIL,GAApB,EAAyBK,GAAzB,EAA8B;AAC5BN,gBAAIM,CAAJ,EAAOC,KAAP,CAAa,IAAb,EAAmBJ,IAAnB;AACD;AACF,SAJD,SAIU;AACR,cAAIH,IAAIE,MAAJ,GAAaD,GAAjB,EAAsB;AACpB;AACA;AACAD,gBAAIQ,MAAJ,CAAW,CAAX,EAAcP,GAAd;AACAQ,oBAAQC,QAAR,CAAiB,YAAY;AAC3BX,kBAAIQ,KAAJ,CAAU,IAAV,EAAgBJ,IAAhB;AACD,aAFD;AAGD,WAPD,MAOO;AACL,mBAAOf,KAAKO,GAAL,CAAP;AACD;AACF;AACF,OA3BM,CAAP;AA4BD;;AAED,aAASS,KAAT,CAAgBD,IAAhB,EAAsB;AACpB,UAAID,SAASC,KAAKD,MAAlB;AACA,UAAIS,QAAQ,EAAZ;;AAEA,WAAK,IAAIL,IAAI,CAAb,EAAgBA,IAAIJ,MAApB,EAA4BI,GAA5B,EAAiCK,MAAML,CAAN,IAAWH,KAAKG,CAAL,CAAX;AACjC,aAAOK,KAAP;AACD","file":"inflight.js","sourcesContent":["var wrappy = require('wrappy')\nvar reqs = Object.create(null)\nvar once = require('once')\n\nmodule.exports = wrappy(inflight)\n\nfunction inflight (key, cb) {\n  if (reqs[key]) {\n    reqs[key].push(cb)\n    return null\n  } else {\n    reqs[key] = [cb]\n    return makeres(key)\n  }\n}\n\nfunction makeres (key) {\n  return once(function RES () {\n    var cbs = reqs[key]\n    var len = cbs.length\n    var args = slice(arguments)\n\n    // XXX It's somewhat ambiguous whether a new callback added in this\n    // pass should be queued for later execution if something in the\n    // list of callbacks throws, or if it should just be discarded.\n    // However, it's such an edge case that it hardly matters, and either\n    // choice is likely as surprising as the other.\n    // As it happens, we do go ahead and schedule it for later execution.\n    try {\n      for (var i = 0; i < len; i++) {\n        cbs[i].apply(null, args)\n      }\n    } finally {\n      if (cbs.length > len) {\n        // added more in the interim.\n        // de-zalgo, just in case, but don't call again.\n        cbs.splice(0, len)\n        process.nextTick(function () {\n          RES.apply(null, args)\n        })\n      } else {\n        delete reqs[key]\n      }\n    }\n  })\n}\n\nfunction slice (args) {\n  var length = args.length\n  var array = []\n\n  for (var i = 0; i < length; i++) array[i] = args[i]\n  return array\n}\n"]}