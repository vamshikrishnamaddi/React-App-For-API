{"version":3,"sources":["SourceConnector.js"],"names":["Object","defineProperty","exports","value","SourceConnector","_wrapConnectorHooks","require","_isRef","_shallowequal","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","_createClass","protoProps","staticProps","prototype","backend","_this","hooks","wrapConnectorHooks","dragSource","node","options","clearDragSource","dragSourceOptions","isRef","dragSourceRef","dragSourceNode","reconnectDragSource","dragPreview","clearDragPreview","dragPreviewOptions","dragPreviewRef","dragPreviewNode","reconnectDragPreview","handlerId","dragSourceOptionsInternal","dragPreviewOptionsInternal","lastConnectedHandlerId","lastConnectedDragSource","lastConnectedDragSourceOptions","lastConnectedDragPreview","lastConnectedDragPreviewOptions","receiveHandlerId","newHandlerId","reconnect","didChange","didHandlerIdChange","didConnectedDragSourceChange","didDragSourceOptionsChange","disconnectDragSource","dragSourceUnsubscribe","connectDragSource","didConnectedDragPreviewChange","didDragPreviewOptionsChange","disconnectDragPreview","dragPreviewUnsubscribe","connectDragPreview","shallowEqual","undefined","get","set","current"],"mappings":"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","file":"SourceConnector.js","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SourceConnector = void 0;\n\nvar _wrapConnectorHooks = require(\"./wrapConnectorHooks\");\n\nvar _isRef = require(\"../utils/isRef\");\n\nvar _shallowequal = require(\"@react-dnd/shallowequal\");\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar SourceConnector = /*#__PURE__*/function () {\n  function SourceConnector(backend) {\n    var _this = this;\n\n    _classCallCheck(this, SourceConnector);\n\n    this.hooks = (0, _wrapConnectorHooks.wrapConnectorHooks)({\n      dragSource: function dragSource(node, options) {\n        _this.clearDragSource();\n\n        _this.dragSourceOptions = options || null;\n\n        if ((0, _isRef.isRef)(node)) {\n          _this.dragSourceRef = node;\n        } else {\n          _this.dragSourceNode = node;\n        }\n\n        _this.reconnectDragSource();\n      },\n      dragPreview: function dragPreview(node, options) {\n        _this.clearDragPreview();\n\n        _this.dragPreviewOptions = options || null;\n\n        if ((0, _isRef.isRef)(node)) {\n          _this.dragPreviewRef = node;\n        } else {\n          _this.dragPreviewNode = node;\n        }\n\n        _this.reconnectDragPreview();\n      }\n    });\n    this.handlerId = null; // The drop target may either be attached via ref or connect function\n\n    this.dragSourceRef = null;\n    this.dragSourceOptionsInternal = null; // The drag preview may either be attached via ref or connect function\n\n    this.dragPreviewRef = null;\n    this.dragPreviewOptionsInternal = null;\n    this.lastConnectedHandlerId = null;\n    this.lastConnectedDragSource = null;\n    this.lastConnectedDragSourceOptions = null;\n    this.lastConnectedDragPreview = null;\n    this.lastConnectedDragPreviewOptions = null;\n    this.backend = backend;\n  }\n\n  _createClass(SourceConnector, [{\n    key: \"receiveHandlerId\",\n    value: function receiveHandlerId(newHandlerId) {\n      if (this.handlerId === newHandlerId) {\n        return;\n      }\n\n      this.handlerId = newHandlerId;\n      this.reconnect();\n    }\n  }, {\n    key: \"reconnect\",\n    value: function reconnect() {\n      this.reconnectDragSource();\n      this.reconnectDragPreview();\n    }\n  }, {\n    key: \"reconnectDragSource\",\n    value: function reconnectDragSource() {\n      var dragSource = this.dragSource; // if nothing has changed then don't resubscribe\n\n      var didChange = this.didHandlerIdChange() || this.didConnectedDragSourceChange() || this.didDragSourceOptionsChange();\n\n      if (didChange) {\n        this.disconnectDragSource();\n      }\n\n      if (!this.handlerId) {\n        return;\n      }\n\n      if (!dragSource) {\n        this.lastConnectedDragSource = dragSource;\n        return;\n      }\n\n      if (didChange) {\n        this.lastConnectedHandlerId = this.handlerId;\n        this.lastConnectedDragSource = dragSource;\n        this.lastConnectedDragSourceOptions = this.dragSourceOptions;\n        this.dragSourceUnsubscribe = this.backend.connectDragSource(this.handlerId, dragSource, this.dragSourceOptions);\n      }\n    }\n  }, {\n    key: \"reconnectDragPreview\",\n    value: function reconnectDragPreview() {\n      var dragPreview = this.dragPreview; // if nothing has changed then don't resubscribe\n\n      var didChange = this.didHandlerIdChange() || this.didConnectedDragPreviewChange() || this.didDragPreviewOptionsChange();\n\n      if (didChange) {\n        this.disconnectDragPreview();\n      }\n\n      if (!this.handlerId) {\n        return;\n      }\n\n      if (!dragPreview) {\n        this.lastConnectedDragPreview = dragPreview;\n        return;\n      }\n\n      if (didChange) {\n        this.lastConnectedHandlerId = this.handlerId;\n        this.lastConnectedDragPreview = dragPreview;\n        this.lastConnectedDragPreviewOptions = this.dragPreviewOptions;\n        this.dragPreviewUnsubscribe = this.backend.connectDragPreview(this.handlerId, dragPreview, this.dragPreviewOptions);\n      }\n    }\n  }, {\n    key: \"didHandlerIdChange\",\n    value: function didHandlerIdChange() {\n      return this.lastConnectedHandlerId !== this.handlerId;\n    }\n  }, {\n    key: \"didConnectedDragSourceChange\",\n    value: function didConnectedDragSourceChange() {\n      return this.lastConnectedDragSource !== this.dragSource;\n    }\n  }, {\n    key: \"didConnectedDragPreviewChange\",\n    value: function didConnectedDragPreviewChange() {\n      return this.lastConnectedDragPreview !== this.dragPreview;\n    }\n  }, {\n    key: \"didDragSourceOptionsChange\",\n    value: function didDragSourceOptionsChange() {\n      return !(0, _shallowequal.shallowEqual)(this.lastConnectedDragSourceOptions, this.dragSourceOptions);\n    }\n  }, {\n    key: \"didDragPreviewOptionsChange\",\n    value: function didDragPreviewOptionsChange() {\n      return !(0, _shallowequal.shallowEqual)(this.lastConnectedDragPreviewOptions, this.dragPreviewOptions);\n    }\n  }, {\n    key: \"disconnectDragSource\",\n    value: function disconnectDragSource() {\n      if (this.dragSourceUnsubscribe) {\n        this.dragSourceUnsubscribe();\n        this.dragSourceUnsubscribe = undefined;\n      }\n    }\n  }, {\n    key: \"disconnectDragPreview\",\n    value: function disconnectDragPreview() {\n      if (this.dragPreviewUnsubscribe) {\n        this.dragPreviewUnsubscribe();\n        this.dragPreviewUnsubscribe = undefined;\n        this.dragPreviewNode = null;\n        this.dragPreviewRef = null;\n      }\n    }\n  }, {\n    key: \"clearDragSource\",\n    value: function clearDragSource() {\n      this.dragSourceNode = null;\n      this.dragSourceRef = null;\n    }\n  }, {\n    key: \"clearDragPreview\",\n    value: function clearDragPreview() {\n      this.dragPreviewNode = null;\n      this.dragPreviewRef = null;\n    }\n  }, {\n    key: \"connectTarget\",\n    get: function get() {\n      return this.dragSource;\n    }\n  }, {\n    key: \"dragSourceOptions\",\n    get: function get() {\n      return this.dragSourceOptionsInternal;\n    },\n    set: function set(options) {\n      this.dragSourceOptionsInternal = options;\n    }\n  }, {\n    key: \"dragPreviewOptions\",\n    get: function get() {\n      return this.dragPreviewOptionsInternal;\n    },\n    set: function set(options) {\n      this.dragPreviewOptionsInternal = options;\n    }\n  }, {\n    key: \"dragSource\",\n    get: function get() {\n      return this.dragSourceNode || this.dragSourceRef && this.dragSourceRef.current;\n    }\n  }, {\n    key: \"dragPreview\",\n    get: function get() {\n      return this.dragPreviewNode || this.dragPreviewRef && this.dragPreviewRef.current;\n    }\n  }]);\n\n  return SourceConnector;\n}();\n\nexports.SourceConnector = SourceConnector;"]}