{"version":3,"sources":["SourceConnector.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","prototype","wrapConnectorHooks","isRef","shallowEqual","SourceConnector","backend","_this","hooks","dragSource","node","options","clearDragSource","dragSourceOptions","dragSourceRef","dragSourceNode","reconnectDragSource","dragPreview","clearDragPreview","dragPreviewOptions","dragPreviewRef","dragPreviewNode","reconnectDragPreview","handlerId","dragSourceOptionsInternal","dragPreviewOptionsInternal","lastConnectedHandlerId","lastConnectedDragSource","lastConnectedDragSourceOptions","lastConnectedDragPreview","lastConnectedDragPreviewOptions","value","receiveHandlerId","newHandlerId","reconnect","didChange","didHandlerIdChange","didConnectedDragSourceChange","didDragSourceOptionsChange","disconnectDragSource","dragSourceUnsubscribe","connectDragSource","didConnectedDragPreviewChange","didDragPreviewOptionsChange","disconnectDragPreview","dragPreviewUnsubscribe","connectDragPreview","undefined","get","set","current"],"mappings":"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","file":"SourceConnector.js","sourcesContent":["function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nimport { wrapConnectorHooks } from './wrapConnectorHooks';\nimport { isRef } from '../utils/isRef';\nimport { shallowEqual } from '@react-dnd/shallowequal';\nexport var SourceConnector = /*#__PURE__*/function () {\n  function SourceConnector(backend) {\n    var _this = this;\n\n    _classCallCheck(this, SourceConnector);\n\n    this.hooks = wrapConnectorHooks({\n      dragSource: function dragSource(node, options) {\n        _this.clearDragSource();\n\n        _this.dragSourceOptions = options || null;\n\n        if (isRef(node)) {\n          _this.dragSourceRef = node;\n        } else {\n          _this.dragSourceNode = node;\n        }\n\n        _this.reconnectDragSource();\n      },\n      dragPreview: function dragPreview(node, options) {\n        _this.clearDragPreview();\n\n        _this.dragPreviewOptions = options || null;\n\n        if (isRef(node)) {\n          _this.dragPreviewRef = node;\n        } else {\n          _this.dragPreviewNode = node;\n        }\n\n        _this.reconnectDragPreview();\n      }\n    });\n    this.handlerId = null; // The drop target may either be attached via ref or connect function\n\n    this.dragSourceRef = null;\n    this.dragSourceOptionsInternal = null; // The drag preview may either be attached via ref or connect function\n\n    this.dragPreviewRef = null;\n    this.dragPreviewOptionsInternal = null;\n    this.lastConnectedHandlerId = null;\n    this.lastConnectedDragSource = null;\n    this.lastConnectedDragSourceOptions = null;\n    this.lastConnectedDragPreview = null;\n    this.lastConnectedDragPreviewOptions = null;\n    this.backend = backend;\n  }\n\n  _createClass(SourceConnector, [{\n    key: \"receiveHandlerId\",\n    value: function receiveHandlerId(newHandlerId) {\n      if (this.handlerId === newHandlerId) {\n        return;\n      }\n\n      this.handlerId = newHandlerId;\n      this.reconnect();\n    }\n  }, {\n    key: \"reconnect\",\n    value: function reconnect() {\n      this.reconnectDragSource();\n      this.reconnectDragPreview();\n    }\n  }, {\n    key: \"reconnectDragSource\",\n    value: function reconnectDragSource() {\n      var dragSource = this.dragSource; // if nothing has changed then don't resubscribe\n\n      var didChange = this.didHandlerIdChange() || this.didConnectedDragSourceChange() || this.didDragSourceOptionsChange();\n\n      if (didChange) {\n        this.disconnectDragSource();\n      }\n\n      if (!this.handlerId) {\n        return;\n      }\n\n      if (!dragSource) {\n        this.lastConnectedDragSource = dragSource;\n        return;\n      }\n\n      if (didChange) {\n        this.lastConnectedHandlerId = this.handlerId;\n        this.lastConnectedDragSource = dragSource;\n        this.lastConnectedDragSourceOptions = this.dragSourceOptions;\n        this.dragSourceUnsubscribe = this.backend.connectDragSource(this.handlerId, dragSource, this.dragSourceOptions);\n      }\n    }\n  }, {\n    key: \"reconnectDragPreview\",\n    value: function reconnectDragPreview() {\n      var dragPreview = this.dragPreview; // if nothing has changed then don't resubscribe\n\n      var didChange = this.didHandlerIdChange() || this.didConnectedDragPreviewChange() || this.didDragPreviewOptionsChange();\n\n      if (didChange) {\n        this.disconnectDragPreview();\n      }\n\n      if (!this.handlerId) {\n        return;\n      }\n\n      if (!dragPreview) {\n        this.lastConnectedDragPreview = dragPreview;\n        return;\n      }\n\n      if (didChange) {\n        this.lastConnectedHandlerId = this.handlerId;\n        this.lastConnectedDragPreview = dragPreview;\n        this.lastConnectedDragPreviewOptions = this.dragPreviewOptions;\n        this.dragPreviewUnsubscribe = this.backend.connectDragPreview(this.handlerId, dragPreview, this.dragPreviewOptions);\n      }\n    }\n  }, {\n    key: \"didHandlerIdChange\",\n    value: function didHandlerIdChange() {\n      return this.lastConnectedHandlerId !== this.handlerId;\n    }\n  }, {\n    key: \"didConnectedDragSourceChange\",\n    value: function didConnectedDragSourceChange() {\n      return this.lastConnectedDragSource !== this.dragSource;\n    }\n  }, {\n    key: \"didConnectedDragPreviewChange\",\n    value: function didConnectedDragPreviewChange() {\n      return this.lastConnectedDragPreview !== this.dragPreview;\n    }\n  }, {\n    key: \"didDragSourceOptionsChange\",\n    value: function didDragSourceOptionsChange() {\n      return !shallowEqual(this.lastConnectedDragSourceOptions, this.dragSourceOptions);\n    }\n  }, {\n    key: \"didDragPreviewOptionsChange\",\n    value: function didDragPreviewOptionsChange() {\n      return !shallowEqual(this.lastConnectedDragPreviewOptions, this.dragPreviewOptions);\n    }\n  }, {\n    key: \"disconnectDragSource\",\n    value: function disconnectDragSource() {\n      if (this.dragSourceUnsubscribe) {\n        this.dragSourceUnsubscribe();\n        this.dragSourceUnsubscribe = undefined;\n      }\n    }\n  }, {\n    key: \"disconnectDragPreview\",\n    value: function disconnectDragPreview() {\n      if (this.dragPreviewUnsubscribe) {\n        this.dragPreviewUnsubscribe();\n        this.dragPreviewUnsubscribe = undefined;\n        this.dragPreviewNode = null;\n        this.dragPreviewRef = null;\n      }\n    }\n  }, {\n    key: \"clearDragSource\",\n    value: function clearDragSource() {\n      this.dragSourceNode = null;\n      this.dragSourceRef = null;\n    }\n  }, {\n    key: \"clearDragPreview\",\n    value: function clearDragPreview() {\n      this.dragPreviewNode = null;\n      this.dragPreviewRef = null;\n    }\n  }, {\n    key: \"connectTarget\",\n    get: function get() {\n      return this.dragSource;\n    }\n  }, {\n    key: \"dragSourceOptions\",\n    get: function get() {\n      return this.dragSourceOptionsInternal;\n    },\n    set: function set(options) {\n      this.dragSourceOptionsInternal = options;\n    }\n  }, {\n    key: \"dragPreviewOptions\",\n    get: function get() {\n      return this.dragPreviewOptionsInternal;\n    },\n    set: function set(options) {\n      this.dragPreviewOptionsInternal = options;\n    }\n  }, {\n    key: \"dragSource\",\n    get: function get() {\n      return this.dragSourceNode || this.dragSourceRef && this.dragSourceRef.current;\n    }\n  }, {\n    key: \"dragPreview\",\n    get: function get() {\n      return this.dragPreviewNode || this.dragPreviewRef && this.dragPreviewRef.current;\n    }\n  }]);\n\n  return SourceConnector;\n}();"]}